---
title: "Statistical Analyses for Reputational Incentives Can Motivate Authentic Prosocial Signaling"
author: "Nathan Liang"
date: "October 15, 2025"
format: 
  html:
    code-fold: true
    code-tools: true
editor: "source"
number_sections: true
theme:
  dark: "darkly"
  light: "flatly"
---

# Initialization

## Identify Dependencies

```{r identify-dependencies, include=F, message=F, warning=F}
dependencies <- unique(renv::dependencies()$Package)
print(dependencies)
```

## Load Packages

```{r load-packages, include=F, message=F, warning=F}
if (!require(pacman)) install.packages('pacman'); require(pacman)

pacman::p_load(
  # Read/write data
  vroom, here, renv, janitor,
  
  # Reformat data
  dplyr, tidyr, tidyselect, stringr, forcats, knitr,
  lubridate, magrittr, rmarkdown, purrr,
  
  # Analyze data
  emmeans, effectsize, parameters, performance, rstatix, 
  car, scales, lmtest, psych,
  
  # Visualize data
  patchwork, ggsignif, ggnewscale, ggblend,
  rlang, sysfonts, ggplot2, ggpp, ggtext, fillpattern, papaja)
```

# Initialize Fonts for Plotting

```{r load-fonts}
# Load custom fonts
sysfonts::font_add(
  family  = "fa-solid", 
  regular = "/User/nathan/Library/Fonts/Font Awesome 7 Free-Solid-900.otf")
sysfonts::font_add(
  family  = "Helvetica Neue LT 57 Condensed Bold",
  regular = "/Users/nathan/Library/Fonts/HelveticaNeueLT57CondensedBold.ttf")
sysfonts::font_add(
  family  = "Helvetica Neue LT 57 Condensed",
  regular = "/Users/nathan/Library/Fonts/HelveticaNeueLT57Condensed.ttf")

# Set global showtext settings to display fonts correctly
showtext::showtext_auto()
showtext::showtext_opts(dpi = 300)
```

## Import Data

```{r import-data, message=F, warning=F}
# Import data
df_complete <- vroom::vroom(
  here::here("main/data/clean/main-data-clean-complete.csv"),
  delim = ",", show_col_types = F) |> 
  dplyr::mutate(
    partner_choice = forcats::fct_relevel(
      as.factor(partner_choice), c("no", "yes")),
    public_private = forcats::fct_relevel(
      as.factor(public_private), c("private", "public")))
```

## Set Custom Plotting Theme

```{r plotting-defaults, message=F, warning=F, results="hide"}
theme_aps <- function() {
  list(
    ggplot2::theme_bw() +
      ggplot2::theme(
        text = ggplot2::element_text(
          color  = "black", 
          family = "Helvetica Neue LT 57 Condensed"),
        axis.ticks = ggplot2::element_line(
          color     = "black", 
          linewidth = 0.25),
        axis.ticks.length = ggplot2::unit(.05, units = "cm"),
        axis.title.x = ggtext::element_markdown(
          color  = "black",
          size   = 10,
          margin = margin(t = 10)),
        axis.text.x = ggplot2::element_text(
          color = "black",
          size  = 9),
        axis.title.y = ggtext::element_markdown(
          size   = 10, 
          angle  = 90,
          margin = margin(r = 7.5)),
        axis.text.y = ggplot2::element_text(
          color = "black",
          size  = 9),
        axis.line.x  = ggplot2::element_line(
          color     = "black", 
          linewidth = 0.25),
        axis.line.y = ggplot2::element_line(
          color     = "black", 
          linewidth = 0.25),
        panel.grid.major = ggplot2::element_blank(),
        panel.grid.minor = ggplot2::element_blank(),
        panel.border = ggplot2::element_rect(
          color     = "black",
          linewidth = 0.25),
        strip.background = ggplot2::element_rect(
          color     = "black", 
          linewidth = 0.25),
        strip.text           = ggplot2::element_text(size = 10),
        legend.title         = ggtext::element_markdown(size = 10),
        legend.text          = ggplot2::element_text(size = 9),
        legend.key.size      = ggplot2::unit(.75, "line"),
        legend.justification = "center",
        legend.position      = "bottom",
        legend.box           = "horizontal"))
}
```

## Custom Icon Wrapper Function

```{r icon-wrapper-function}
IconWrapper <- function(icon, font_size = 7) {
  paste0(
    "<span style='font-family:\"fa-solid\"; font-size:", font_size, "pt;'>",
    icon,
    "</span>")
}
```

## Review and Correct Data Types

```{r review-data-types, message=F, warning=F}
# str(df)
df_complete <- df_complete |> 
  # Response ID
  dplyr::mutate(
    dplyr::across(c(
      participant_id, batch, believe_real, 
      group_id, unique_group_id, partner_choice, public_private), 
      as.factor)) |> 
  
  dplyr::mutate(
    
    # Race/Ethnicity
    race_ethnicity = as.factor(
      dplyr::case_when(
        grepl(",", race_ethnicity) ~ "Multiracial", 
        race_ethnicity == "Prefer not to disclose" ~ NA,
        race_ethnicity == "Native Hawaiian or other Pacific Islander" ~ "NH/PI",
        race_ethnicity == "Indigenous American or Alaskan Native" ~ "IA/AN",
        race_ethnicity == "White or Caucasian" ~ "White",
        race_ethnicity == "Black or African American" ~ "B/AA",
        race_ethnicity == "Asian or Asian American" ~ "A/AA",
        .default = race_ethnicity)),
    
    # Gender
    gender = forcats::fct_relevel(
      as.factor(
        dplyr::case_when(
          gender == "An identity not listed" ~ "Other",
          gender == "Nonbinary person"       ~ "Other",
          gender == "Prefer not to disclose" ~ NA,
          .default = gender)), "Man", "Woman", "Other"),
    
    # Income
    income = forcats::fct_relevel(
      dplyr::case_match(
        income,
        "< $10,000"            ~ "<$10,000",
        "$10,000 to $19,999"   ~ "$10,000–$19,999",
        "$20,000 to $29,999"   ~ "$20,000–$29,999",
        "$30,000 to $39,999"   ~ "$30,000–$39,999",
        "$40,000 to $49,999"   ~ "$40,000–$49,999",
        "$50,000 to $74,999"   ~ "$50,000–$74,999",
        "$75,000 to $99,999"   ~ "$75,000–$99,999",
        "$100,000 to $149,999" ~ "$100,000–$149,999",
        .default = income),
      "<$10,000", 
      "$10,000–$19,999", 
      "$20,000–$29,999", 
      "$30,000–$39,999", 
      "$40,000–$49,999", 
      "$50,000–$74,999", 
      "$75,000–$99,999",
      "$100,000–$149,999", 
      ">$150,000"),
    
    # Education
    education = forcats::fct_relevel(
      dplyr::case_match(
        education,
        "Less than a high school diploma" ~ "< High school",
        "High school degree or equivalent (e.g. GED)" ~ "High school",
        "Associate Degree (e.g. AA, AS)"  ~ "Associate",
        "Some college, no degree" ~ "Some college, no degree",
        "Bachelor's Degree (e.g. BA, BS)" ~ "Bachelor's",
        "Postgraduate Degree (e.g. Master's Degree, Professional Degree, Doctorate Degree)" ~ "Postgraduate"),
      c("< High school", "High school", "Associate", "Some college, no degree",
        "Bachelor's","Postgraduate")),
    
    # Employment Status
    employment = forcats::fct_relevel(
      dplyr::case_match(
        employment,
        "Employed full time (30+ hrs/week)" ~ "Full-time",
        "Employed part-time (>30 hrs/week)" ~ "Part-time",
        "Unemployed and currently looking for work" ~ 
          "Unemployed but applying",
        "Unemployed and not currently looking for work" ~ 
          "Unemployed and not applying",
        "Self-Employed"  ~ "Self-employed",
        "Unable to work" ~ "Unable to Work",
        .default = employment), 
      "Unable to work", 
      "Unemployed and not applying", 
      "Unemployed but applying", 
      "Homemaker", 
      "Student", 
      "Self-Employed", 
      "Part-Time", 
      "Full-Time", 
      "Retired"),
    
    # Political Affiliation
    political_overall = forcats::fct_relevel(
      dplyr::case_match(
        political_overall, 
        "Something else:" ~ "Other", 
        .default = political_overall), 
      "Republican", "Democrat", "Independent", "Other"),
    
    believe_real = dplyr::if_else(believe_real == "Yes", 1, 0))
```

------------------------------------------------------------------------

# Main Text Analyses

## H1: "Expressed as Signal"

### Modeling Game Behavior

#### Prep Data

```{r hypothesis-1-prep-data, message=F, warning=F}
# --------- #
# PREP DATA #
# --------- #
df_h1 <- df_complete |> 
  dplyr::select(
    participant_role, public_private, partner_choice, dg_a_gen_transfer) |> 
  dplyr::filter(stringr::str_starts(participant_role, "A")) |> 
  tidyr::drop_na(dg_a_gen_transfer) |> 
  dplyr::mutate(
    partner_choice = forcats::fct_relevel(
      dplyr::case_when(
        partner_choice == "yes" ~ "Yes",
        partner_choice == "no"  ~ "No"),
      c("No", "Yes")),
    public_private = forcats::fct_relevel(
      dplyr::case_when(
        public_private == "public"  ~ "Public",
        public_private == "private" ~ "Private"),
      c("Private", "Public")))
```

#### Linear Model

```{r hypothesis-1-lm, message=F, warning=F}
#| lst-label: h1-lm
#| lst-cap: H1 Game Behavior Linear Model
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h1 <- lm(
  formula   = dg_a_gen_transfer ~ public_private + partner_choice, 
  data      = df_h1,
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_h1 <- car::Anova(lm_h1, type = 3)
parameters::model_parameters(anova_lm_h1)
effectsize::effectsize(anova_lm_h1, alternative = "two.sided") |> 
  knitr::kable(digits = c(0, 3, 2, 3, 3))

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(df_h1$public_private)
lm_h1_obs_emm <- emmeans::emmeans(lm_h1, specs = ~public_private)
parameters::model_parameters(lm_h1_obs_emm)

table(df_h1$partner_choice)
lm_h1_pc_emm <- emmeans::emmeans(lm_h1, specs = ~partner_choice)
parameters::model_parameters(lm_h1_pc_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h1_obs_emm, 
    method = "pairwise", 
    infer  = T,
    adjust = "none"))

# Partner Choice: Yes - No
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h1_pc_emm, 
    method = "pairwise", 
    infer  = T,
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h1_obs_emm, 
    sigma  = sigma(lm_h1), 
    edf    = df.residual(lm_h1)))

# Partner Choice: Yes - No (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h1_pc_emm, 
    sigma  = sigma(lm_h1),
    edf    = df.residual(lm_h1)))
```

#### Data Visualization

```{r hypothesis-h1a-data-vis}
#| lst-label: h1a-data-vis
#| lst-cap: H1a Game Behavior Observabilty Data Visualization
# ----------------------- #
# DATA VIS: OBSERVABILITY #
# ----------------------- #
set.seed(42)
h1a_vis <- emmeans::emmeans(lm_h1, specs = ~public_private) |>
  as.data.frame() |> 
  janitor::clean_names('snake') |>
  tidyr::drop_na() |> 
  ggplot2::ggplot(
    ggplot2::aes(x = public_private, y = emmean),
    color = "#4f46e5", 
    fill  = "#4f46e5") +
  ggplot2::labs(
    x = "Observability", 
    y = "Mean Dictator Game Send ($)") +
  
  # Bar Plot
  ggplot2::geom_bar(
    ggplot2::aes(alpha = public_private),
    color     = "#4f46e5",
    fill      = "#4f46e5",
    stat      = "summary", 
    fun       = mean, 
    width     = 0.75, 
    linewidth = 0.5) +
  ggplot2::scale_alpha_manual(values = c(Public = 0.1, Private = 0.6)) +
  
  # Manual Aesthetics Mappings
  ggplot2::guides(alpha = "none") +
  
  # Raw Data as Jitter
  ggplot2::geom_jitter(
    ggplot2::aes(y = dg_a_gen_transfer),
    data     = df_h1,
    color    = "#4f46e5",
    fill     = "#4f46e5",
    stroke   = 0, 
    size     = 0.5, 
    alpha    = 0.35,
    position = ggplot2::position_jitter(.05, 0.01)) * 
  (ggblend::blend("lighten") + ggblend::blend("multiply", alpha = 0.2)) +
  
  # Box Plot
  ggplot2::geom_boxplot(
    ggplot2::aes(x = public_private, y = dg_a_gen_transfer),
    color        = "#4f46e5",
    fill         = "#4f46e5",
    width        = 0.3, 
    alpha        = 0.25,
    outlier.size = 0.25, linewidth = 0.25,
    position     = ggplot2::position_dodge(width = 0.8), 
    data         = df_h1, 
    show.legend  = F) +
  
  # Violin Plot
  ggplot2::geom_violin(
    ggplot2::aes(x = public_private, y = dg_a_gen_transfer),
    color       = "#4f46e5",
    fill        = "#4f46e5",
    width       = 0.7, 
    alpha       = 0.25, 
    linewidth   = 0,
    position    = ggplot2::position_dodge(width = 0.8), 
    data        = df_h1, 
    show.legend = F) +
  
  # Error Bars
  ggplot2::geom_errorbar(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl),
    position = ggplot2::position_dodge(width = 1), 
    width    = 0.15, 
    color    = "black") +
  
  # Mean Point Estimates
  ggplot2::geom_point(
    ggplot2::aes(x = public_private, y = emmean),
    position = ggplot2::position_dodge(width = 1), 
    size     = 0.75, 
    color    = "black") +
  
  # Axis Limits
  ggplot2::scale_y_continuous(
    limits       = c(0, 0.7), 
    breaks       = seq(0, 0.6, by = 0.1), 
    minor_breaks = NULL,
    labels       = scales::number_format(accuracy = 0.01),
    expand       = c(0, 0)) +
  ggplot2::coord_cartesian(ylim = c(0, 0.575), clip = "off") +
  
  theme_aps() +
  ggplot2::guides(
    fill = "none", color = "none", pattern = "none", pattern_color = "none") +
  ggsignif::geom_signif(
    size = 0.25,
    family = "Helvetica Neue LT 57 Condensed",
    y_position = 0.5,
    comparisons = list(c("Private", "Public")),
    annotations  = c("***"),
    color = "black", textsize = 3, 
    vjust = 0.5, hjust = 0.5, tip_length = 0)

# Display Figure
h1a_vis
```


```{r hypothesis-1b-data-vis}
#| lst-label: h1b-data-vis
#| lst-cap: H1b Game Behavior Partner Choice Data Visualization
# ------------------------ #
# DATA VIS: PARNTER CHOICE #
# ------------------------ #
set.seed(42)
h1b_vis <- emmeans::emmeans(lm_h1, specs = ~partner_choice) |>
  as.data.frame() |> janitor::clean_names('snake') |>
  ggplot2::ggplot(
    ggplot2::aes(
      x     = partner_choice,
      y     = emmean,
      fill  = partner_choice,
      color = partner_choice)) +
  ggplot2::labs(
    x = "Partner Choice", 
    y = "Mean Dictator Game Send ($)") +
  ggplot2::geom_bar(
    stat = "summary", fun = mean, width = 0.75, linewidth = 0.5) +
  
  fillpattern::scale_fill_pattern(
    bg = c("No"  = "#e6904c80",
           "Yes" = "#69c3f580"),
    fg = c("No"  = "#D55E0080",
           "Yes" = "#0072B280"),
    patterns = "stripe45_0.25") +
  
  ggplot2::guides(fill = "none") +
  ggnewscale::new_scale_fill() +
  
  # Jitter (Raw Data)
  ggplot2::geom_jitter(
    data = df_h1, ggplot2::aes(y = dg_a_gen_transfer),
    stroke = 0, alpha = 0.35, size = 0.5,
    position = ggplot2::position_jitterdodge(.1, 0.01, dodge.width = 1)) *
  (ggblend::blend("lighten") + ggblend::blend("multiply", alpha = 0.2)) +
  
  # Box Plot
  ggplot2::geom_boxplot(
    inherit.aes = F,
    ggplot2::aes(
      x = partner_choice, y = dg_a_gen_transfer,
      fill = partner_choice, color = partner_choice),
    width = 0.3, alpha = 0.25, outlier.size = 0.5, linewidth = 0.25,
    data = df_h1, show.legend = F) +
  
  # Violin Plot
  ggplot2::geom_violin(
    inherit.aes = F,
    ggplot2::aes(
      x = partner_choice, y = dg_a_gen_transfer,
      fill = partner_choice, color = partner_choice),
    width = 0.7, alpha = 0.25, linewidth = 0,
    data = df_h1, show.legend = F) +
  
  # Error Bars
  ggplot2::geom_errorbar(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl),
    width = 0.15, color = "black") +
  
  # Mean Point Estimates
  ggplot2::geom_point(
    ggplot2::aes(x = partner_choice, y = emmean),
    size = 0.75, color = "black") +
  
  # Axis Limits
  ggplot2::scale_y_continuous(
    limits = c(0, 0.6), breaks = seq(0, 0.6, by = 0.10), minor_breaks = NULL,
    labels = scales::number_format(accuracy = 0.01),
    expand = c(0, 0)) +
  ggplot2::coord_cartesian(ylim = c(0, 0.575), clip = "off") +
  
  # Significance Annotations
  ggsignif::geom_signif(
    family      = "Helvetica Neue LT 57 Condensed",
    size        = 0.25,
    y_position  = 0.5,
    comparisons = list(c("No", "Yes")),
    annotations = c("NS."),
    color       = "black", 
    textsize    = 2, 
    vjust       = 0.1, 
    hjust       = 0.5, 
    tip_length  = 0) +
  
  # Manual Aesthetics Mappings
  ggplot2::guides(
    fill = "none", color = "none", pattern = "none", pattern_color = "none") +
  ggplot2::scale_color_manual(
    values = c(No = "#D55E00", Yes = "#0072B2")) +
  ggplot2::scale_fill_manual(
    values = c(No = "#D55E00", Yes = "#0072B2")) +
  theme_aps()

# Display Figure
h1b_vis
```

```{r hypothesis-1c-data-vis}
#| lst-label: h1c-data-vis
#| lst-cap: H1c Game Behavior Observability x Partner Choice Data Visualization
# --------------------- #
# DATA VIS: INTERACTION #
# --------------------- #
set.seed(42)
h1c_vis <- emmeans::emmeans(lm_h1, specs = ~public_private:partner_choice) |>
  as.data.frame() |> janitor::clean_names('snake') |>
  ggplot2::ggplot(
    ggplot2::aes(
      x             = partner_choice,
      y             = emmean,
      fill          = partner_choice,
      color         = partner_choice)) +
  ggplot2::labs(
    x     = "Partner Choice", 
    y     = "Mean Dictator Game Send ($)",
    color = "Partner Choice",
    fill  = "Partner Choice") +
  
  ggplot2::geom_bar(
    aes(fill = partner_choice, color = partner_choice, alpha = public_private),
    stat = "summary", fun = mean, width = 0.75, linewidth = 0.5) +
  
  ggplot2::scale_alpha_manual(values = c(Public = 0.1, Private = 0.6)) +
  
  # Jitter (Raw Data)
  ggplot2::geom_jitter(
    inherit.aes = F,
    data = df_h1, ggplot2::aes(
      x = partner_choice, y = dg_a_gen_transfer,
      fill = partner_choice, color = partner_choice),
    stroke = 0, alpha = 0.35, size = 0.5,
    position = ggplot2::position_jitterdodge(.25, 0.01, dodge.width = 1)) * 
  (ggblend::blend("lighten") + ggblend::blend("multiply", alpha = 0.2)) +
  
  # Boxplot
  ggplot2::geom_boxplot(
    inherit.aes = F,
    ggplot2::aes(
      x = partner_choice, y = dg_a_gen_transfer,
      fill = partner_choice, color = partner_choice),
    width = 0.3, alpha = 0.25, outlier.size = 0.25, linewidth = 0.25,
    position = ggplot2::position_dodge(width = 0.8), data = df_h1, show.legend = F) +
  
  # Violin
  ggplot2::geom_violin(
    inherit.aes = F,
    ggplot2::aes(
      x = partner_choice, y = dg_a_gen_transfer,
      fill = partner_choice, color = partner_choice),
    width = 0.7, alpha = 0.25, linewidth = 0,
    position = position_dodge(width = 0.8), data = df_h1, show.legend = F) +
  
  # Error Bars and Mean Point Estimates
  ggplot2::geom_errorbar(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl),
    position = position_dodge(width = 1), width = 0.15, color = "black",
    linewidth = 0.5) +
  ggplot2::geom_point(
    ggplot2::aes(x = partner_choice, y = emmean),
    position = position_dodge(width = 1), size = 1, color = "black") +
  
  # Axis Limits
  ggplot2::scale_y_continuous(
    limits = c(0, 0.7), breaks = seq(0, 0.50, by = 0.10), minor_breaks = NULL,
    labels = scales::number_format(accuracy = 0.01),
    expand = c(0, 0)) +
  ggplot2::coord_cartesian(ylim = c(0, 0.55), clip = "off") +
  ggplot2::scale_fill_manual(
    values = c(No = "#D55E00", Yes = "#0072B2")) +
  ggplot2::scale_color_manual(
    values = c(No = "#D55E00", Yes = "#0072B2")) +
  
  # Manual Aesthetics Mapping
  ggplot2::guides(fill = "none", color = "none", alpha = "none") +
  ggplot2::facet_wrap(~public_private) +
  
  # Custom Theme
  theme_aps()

# Display Figure
h1c_vis
```

```{r hypothesis-1abc-data-vis}
#| lst-label: h1abc-data-vis
#| lst-cap: H1a-c Game Behavior Data Visualizations
# Combine Plots
h1_vis_all <- ((h1a_vis / h1b_vis) | h1c_vis) + 
  patchwork::plot_layout(
    widths = c(2, 6), heights = c(8, 8),
    axis_titles = "collect", axes = "collect") +
  patchwork::plot_annotation(tag_levels = "a")

# Save Figure
ggplot2::ggsave(
  filename = here::here("main/figures/hypothesis-1-data-vis.png"),
  plot     = h1_vis_all,
  width    = 8,
  height   = 6,
  dpi      = 300)
```

### Delete H1 Objects

```{r delete-h1-data}
rm(lm_h1, h1_vis, h1a_vis, h1b_vis, h1c_vis, h1_vis_all,
   anova_lm_h1, lm_h1_obs_emm, lm_h1_pc_emm)
```


------------------------------------------------------------------------

## H2: "Actually a Signal"

### Modeling Game Behavior

#### Prep Data

Does actors' generosity in the DG predict how much they *actually* return? 
We will select only participants A, A1, A2, and C for this analysis so as to
remove redundant group-level response (i.e., Participants B didn't play in
this game).

```{r hypothesis-2-prep-data, message=F, warning=F}
#| lst-label: h2-data-prep
#| lst-cap: H2 Game Behavior Data Preparation
# --------- #
# PREP DATA #
# --------- #
df_h2 <- df_complete |> 
  dplyr::filter(!stringr::str_starts(participant_role, "B")) |>
  dplyr::select(
    unique_group_id, participant_role, 
    public_private, partner_choice,
    dg_a_chosen_transfer_ratio, tg_a_return_ratio) |> 
  dplyr::group_by(unique_group_id) |> 
  dplyr::mutate(
    dg_a_chosen_transfer_ratio = dplyr::if_else(
      is.na(dg_a_chosen_transfer_ratio), 
      dplyr::first(na.omit(dg_a_chosen_transfer_ratio)), 
      dg_a_chosen_transfer_ratio),
    tg_a_return_ratio = dplyr::if_else(
      is.na(tg_a_return_ratio), 
      dplyr::first(na.omit(tg_a_return_ratio)), 
      tg_a_return_ratio)) |> 
  dplyr::ungroup() |>
  dplyr::arrange(unique_group_id, participant_role) |> 
  dplyr::distinct(unique_group_id, .keep_all = T)
```

#### Linear Model

```{r hypothesis-2-lm, message=F, warning=F}
#| lst-label: h2-lm
#| lst-cap: H2 Game Behavior Linear Model
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h2 <- lm(
  formula   = tg_a_return_ratio ~ public_private 
  + partner_choice
  + dg_a_chosen_transfer_ratio, 
  data      = df_h2,
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_h2 <- car::Anova(lm_h2, type = 3)
parameters::model_parameters(anova_lm_h2)
effectsize::effectsize(anova_lm_h2) |> as.data.frame()

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(lm_h2, ~1, var = "dg_a_chosen_transfer_ratio", infer = T))

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# Observability: Public - Private
table(df_h2$public_private)
lm_h2_obs_emm <- emmeans::emmeans(lm_h2, specs = ~public_private)
parameters::model_parameters(lm_h2_obs_emm)

# Partner Choice: Yes - No
table(df_h2$partner_choice)
lm_h2_pc_emm <- emmeans::emmeans(lm_h2, specs = ~partner_choice)
parameters::model_parameters(lm_h2_pc_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h2_obs_emm,
    method = "pairwise",
    infer  = T,
    adjust = "none"))

# Partner Choice: Yes - No
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h2_pc_emm,
    method = "pairwise",
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h2_obs_emm,
    sigma  = sigma(lm_h2),
    edf    = df.residual(lm_h2)))

# Partner Choice: Yes - No (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h2_pc_emm,
    sigma  = sigma(lm_h2),
    edf    = df.residual(lm_h2)))
```

#### Curvilinear Model

```{r hypothesis-2-qm, message=F, warning=F}
#| lst-label: h2-qm
#| lst-cap: H2 Game Behavior Quadratic Model
# --------------- #
# QUADRATIC MODEL #
# --------------- #
qm_h2 <- lm(
  formula   = tg_a_return_ratio ~ public_private 
  + partner_choice 
  + dg_a_chosen_transfer_ratio 
  + I(dg_a_chosen_transfer_ratio^2), 
  data      = tidyr::drop_na(df_h2, dg_a_chosen_transfer_ratio),
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(
    qm_h2, ~1, var = "dg_a_chosen_transfer_ratio", infer = T, max.degree = 2))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_qm_h2 <- car::Anova(qm_h2, type = 3)
parameters::model_parameters(anova_qm_h2)
effectsize::effectsize(anova_qm_h2) |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# Observability: Public - Private
table(df_h2$public_private)
qm_h2_obs_emm <- emmeans::emmeans(qm_h2, specs = ~public_private)
parameters::model_parameters(qm_h2_obs_emm)

# Partner Choice: Yes - No
table(df_h2$partner_choice)
qm_h2_pc_emm  <- emmeans::emmeans(qm_h2, specs = ~partner_choice)
parameters::model_parameters(qm_h2_pc_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = qm_h2_obs_emm, 
    method = "pairwise",
    infer  = T, 
    adjust = "none"))

# Partner Choice: Yes - No
parameters::model_parameters(
  emmeans::contrast(
    object = qm_h2_pc_emm, 
    method = "pairwise",
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = qm_h2_obs_emm, 
    sigma  = sigma(qm_h2), 
    edf    = df.residual(qm_h2)))

# Partner Choice: Yes - No (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = qm_h2_pc_emm, 
    sigma  = sigma(qm_h2), 
    edf    = df.residual(qm_h2)))
```

#### Data Visualization

```{r hypothesis-2-visualize, message=F, warning=F}
#| lst-label: h2-data-vis
#| lst-cap: H2 Game Behavior Data Visualization

# Axis Labels
h2_vis_x_title <- paste0(
  "Dictator Game Send Ratio (A ", IconWrapper("\uf178"), " B)")

h2_vis_y_title <- paste0(
  "Trust Game Return Ratio (C ", IconWrapper("\uf177"), " A)")

# Model Predicted EMM
set.seed(42)
qm_h2_vis <- emmeans::emmeans(
  qm_h2,
  specs    = ~public_private:partner_choice,
  cov.keep = "dg_a_chosen_transfer_ratio",
  at       = list(dg_a_chosen_transfer_ratio = seq(0, 1.00, by = 0.01)),
  by       = "dg_a_chosen_transfer_ratio") |>
  as.data.frame() |>
  janitor::clean_names('snake') |>
  dplyr::mutate(
    public_private = dplyr::case_when(
      public_private == "public"  ~ "Public",
      public_private == "private" ~ "Private"),
    partner_choice = dplyr::case_when(
      partner_choice == "no"  ~ "No",
      partner_choice == "yes" ~ "Yes")) |>
  ggplot2::ggplot(
    ggplot2::aes(
      x        = dg_a_chosen_transfer_ratio,
      y        = emmean,
      linetype = public_private,
      fill     = partner_choice,
      color    = partner_choice)) +
  
  # Raw Data as Jitter
  ggplot2::geom_point(
    ggplot2::aes(
      x = dg_a_chosen_transfer_ratio_jittered,
      y = tg_a_return_ratio_jittered),
    data = dplyr::mutate(
      df_h2,
      dg_a_chosen_transfer_ratio_jittered = pmax(
        0.02, 
        pmin(1 - 0.02, 
             dg_a_chosen_transfer_ratio + runif(n(), -0.075, 0.075))),
      tg_a_return_ratio_jittered = pmax(
        0.06, 
        pmin(3 - 0.06,
             tg_a_return_ratio + runif(n(), -0.225, 0.225))),
      public_private = dplyr::case_when(
        public_private == "public"  ~ "Public",
        public_private == "private" ~ "Private"),
      partner_choice = dplyr::case_when(
        partner_choice == "no"  ~ "No",
        partner_choice == "yes" ~ "Yes")),
    stroke = 0, alpha = 0.5, size = 1) +
  
  # Model Prediction Line and Confidence Interval
  ggplot2::geom_line(alpha = 1, linewidth = .5) +
  ggplot2::geom_ribbon(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl), 
    alpha = 0.2, linewidth = 0) +
  
  # Axis Labels and Faceting
  ggplot2::labs(
    x     = h2_vis_x_title,
    y     = h2_vis_y_title, 
    fill  = "Partner Choice",
    color = "Partner Choice") +
  ggplot2::facet_wrap(~public_private) +
  
  # Manual Aesthetics Mappings and Theme
  ggplot2::scale_linetype_manual(
    values = c("Public" = "solid", "Private" = "2222")) +
  ggplot2::scale_color_manual(values = c("#D55E00", "#0072B2")) +
  ggplot2::scale_fill_manual(values = c("#D55E00", "#0072B2")) +
  ggplot2::scale_shape_manual(values = c("square", "circle")) +
  theme_aps() +
  ggplot2::theme(panel.spacing = unit(0.5, "cm")) +
  ggplot2::guides(linetype = "none") +
  
  # Axis Limits
  ggplot2::scale_x_continuous(
    expand = c(0, 0),
    oob    = scales::oob_squish,
    breaks = c(0, 0.25, 0.5, 0.75, 1),
    labels = c("0", "0.25", "0.5", "0.75", "1")) +
  ggplot2::scale_y_continuous(
    expand = c(0, 0),
    oob    = scales::oob_squish,
    labels = scales::label_number(accuracy = 1)) +
  ggplot2::coord_cartesian(
    xlim = c(0, 1), ylim = c(0, 3), clip = "off")

# Display Figure
qm_h2_vis

# Save Figure
ggplot2::ggsave(
  filename = here::here("main/figures/hypothesis-2-data-vis.png"),
  plot     = qm_h2_vis,
  width    = 6,
  height   = 4,
  dpi      = 300)

# Delete Figure Object and Axis Titles
rm(qm_h2_vis, h2_vis_x_title, h2_vis_y_title)
```

------------------------------------------------------------------------

## H3: "Perceived as Signal"

### Modeling Game Behavior

#### Prep Data

```{r hypothesis-3a-prep-data, message=F, warning=F}
# --------- #
# PREP DATA #
# --------- #
df_h3a <- df_complete |>
  dplyr::filter(!stringr::str_starts(participant_role, "B")) |>
  dplyr::select(
    unique_group_id, participant_role, 
    public_private, partner_choice,
    dg_a_chosen_transfer, tg_c_transfer) |> 
  dplyr::group_by(unique_group_id) |> 
  dplyr::mutate(
    dg_a_chosen_transfer = dplyr::if_else(
      is.na(dg_a_chosen_transfer), 
      dplyr::first(na.omit(dg_a_chosen_transfer)), 
      dg_a_chosen_transfer),
    tg_c_transfer = dplyr::if_else(
      is.na(tg_c_transfer),
      dplyr::first(na.omit(tg_c_transfer)), 
      tg_c_transfer)) |> 
  dplyr::ungroup() |>
  dplyr::arrange(unique_group_id, participant_role) |> 
  dplyr::distinct(unique_group_id, .keep_all = T)
```

#### Linear Model

```{r hypothesis-3a-lm, message=F, warning=F}
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h3a <- lm(
  formula = tg_c_transfer ~ dg_a_chosen_transfer, 
  data    = df_h3a)

# Unstandardized Regression Coefficient
parameters::model_parameters(lm_h3a)

# Standardized Regression Coefficient
effectsize::effectsize(lm_h3a)
```

#### Curvilinear Model

```{r hypothesis-3a-qm, message=F, warning=F}
#| lst-label: h3a-qm
#| lst-cap: H3 Game Behavior Quadratic Model
# --------------- #
# QUADRATIC MODEL #
# --------------- #
qm_h3a <- lm(
  formula = tg_c_transfer ~ dg_a_chosen_transfer + I(dg_a_chosen_transfer^2), 
  data    = df_h3a)

# ----------------------- #
# AVERAGE MARGINAL TREND # 
# ----------------------- #
parameters::model_parameters(
  emmeans::emtrends(qm_h3a, ~1, var = "dg_a_chosen_transfer", max.degree = 2))

# ------------------------------------ #
# STANDARDIZED REGRESSION COEFFICIENTS #
# ------------------------------------ #
effectsize::effectsize(qm_h3a)
```

#### Data Visualization

```{r hypothesis-3a-visualize, message=F, warning=F}
#| lst-label: h3-data-vis
#| lst-cap: H3 Game Behavior Data Visualization

# Axis Labels
h3a_vis_x_title <- paste0(
  "Dictator Game Send ($) (A ", IconWrapper("\uf178"), " B)")
h3a_vis_y_title <- paste0(
  "Trust Game Send ($) (C ", IconWrapper("\uf178"), " A)")

set.seed(42)
qm_h3a_vis <- emmeans::emmeans(
  qm_h3a,
  specs    = ~dg_a_chosen_transfer,
  cov.keep = "dg_a_chosen_transfer",
  at       = list(dg_a_chosen_transfer = seq(0, 0.50, by = 0.01)),
  by       = "dg_a_chosen_transfer") |>
  as.data.frame() |>
  janitor::clean_names('snake') |> 
  ggplot2::ggplot(
    ggplot2::aes(
      x = dg_a_chosen_transfer,
      y = emmean)) +
  ggplot2::geom_point(
    ggplot2::aes(
      x = dg_a_chosen_transfer_jittered,
      y = tg_c_transfer_jittered),
    data = dplyr::mutate(
      df_h3a,
      dg_a_chosen_transfer_jittered = pmax(
        0.01, 
        pmin(0.5 - 0.01, 
             dg_a_chosen_transfer + runif(n(), -0.025, 0.025))),
      tg_c_transfer_jittered = pmax(
        0.01, 
        pmin(0.5 - 0.01,
             tg_c_transfer + runif(n(), -0.025, 0.025)))),
    color = "#4f46e5", fill = "#4f46e5",
    stroke = 0, alpha = 0.5, size = 1) +
  
  # Model Prediction Line and Confidence Interval
  ggplot2::geom_smooth(
    method = lm, formula = y ~ x + I(x^2), alpha = 0.2, linewidth = 0.5,
    fill = "#4f46e5", color = "#4f46e5") +
  ggplot2::geom_ribbon(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl), 
    alpha = 0.2, linewidth = 0) +
  
  # Axis Labels
  ggplot2::labs(
    x = h3a_vis_x_title,
    y = h3a_vis_y_title) +
  
  # Custom Theme
  theme_aps() +
  ggplot2::theme(plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm")) +
  
  # Axis Limits
  ggplot2::scale_y_continuous(
    expand = c(0, 0),
    labels = c("0", "0.10", "0.20", "0.30", "0.40", "0.50")) +
  ggplot2::scale_x_continuous(
    expand = c(0, 0),
    labels = c("0", "0.10", "0.20", "0.30", "0.40", "0.50")) +
  ggplot2::coord_cartesian(
    xlim = c(0, 0.5), 
    ylim = c(0, 0.5), 
    clip = "off")

# Display Figure
qm_h3a_vis

# Save Figure
ggplot2::ggsave(
  filename = here::here("main/figures/hypothesis-3a-data-vis.png"),
  plot     = qm_h3a_vis, 
  width    = 4, 
  height   = 3.8, 
  dpi      = 300)

# Delete Figure Object
rm(qm_h3a_vis)
```

### Modeling Morality Ratings

#### Prep Data

```{r hypothesis-3b-prep-data, message=F, warning=F}
# --------- #
# PREP DATA #
# --------- #
df_h3b <- df_complete |> 
  ## Select relevant columns
  dplyr::select(
    participant_id, unique_group_id, participant_role, 
    public_private, partner_choice,
    
    ### DG A/A1/A2 transfers and morality ratings
    dg_a_transfer, dg_a1_transfer, dg_a2_transfer, 
    dg_a_moral, dg_a1_moral, dg_a2_moral) |> 
  
  ## Pivot morality ratings
  ### dg_a_moral | dg_a1_moral | ... | swing into one column
  tidyr::pivot_longer(
    !c(participant_id, unique_group_id, participant_role, 
       public_private, partner_choice,
       dg_a_transfer, dg_a1_transfer, dg_a2_transfer), 
    names_to = "morality_target", values_to = "morality_rating") |> 
  tidyr::drop_na(morality_rating) |> 
  
  ## Pivot transfer allocation ratios
  ### dg_a_transfer_ratio | dg_a1_transfer_ratio | ... | swing into one column
  tidyr::pivot_longer(
    !c(participant_id, unique_group_id, participant_role, 
       public_private, partner_choice, morality_target, morality_rating), 
    names_to = "transfer_allocator", values_to = "transfer") |> 
  tidyr::drop_na(transfer) |>
  
  ## Only keep morality ratings / transfers corresponding to same target / game stage
  dplyr::filter(
    (stringr::str_starts(morality_target, "dg_a_") & 
       stringr::str_starts(transfer_allocator, "dg_a_")) |
      (stringr::str_starts(morality_target, "dg_a1_") & 
         stringr::str_starts(transfer_allocator, "dg_a1_")) |
      (stringr::str_starts(morality_target, "dg_a2_") & 
         stringr::str_starts(transfer_allocator, "dg_a2_"))) |>
  
  ## Remove "_moral" suffix from each morality rating target, make rest uppercase
  dplyr::mutate(
    morality_target = stringr::str_sub(stringr::str_to_upper(
      stringr::str_remove(morality_target, "moral")), end = -2)) |> 
  
  ## Distinguish game (DG vs. TG)—even though it's just DG
  tidyr::separate_wider_delim(
    morality_target, delim = "_", 
    names = c("morality_target_game", "morality_target")) |> 
  dplyr::mutate(
    transfer_allocator = stringr::str_remove(transfer_allocator, "_ratio")) |> 
  dplyr::select(-morality_target_game) |> 
  
  ## Code self-other
  dplyr::mutate(
    self_other = dplyr::if_else(
      participant_role == morality_target, "self", "other"),
    .before = public_private)
```

#### Linear Model

```{r hypothesis-3b-lm, message=F, warning=F}
#| lst-label: h3b-lm
#| lst-cap: H3 Morality Rating Linear Model
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h3b <- lm(
  formula   = morality_rating ~ participant_role + transfer, 
  data      = dplyr::filter(df_h3b, self_other == "other"),
  contrasts = list(participant_role = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_h3b <- car::Anova(lm_h3b, type = 3)
parameters::model_parameters(anova_lm_h3b)
effectsize::effectsize(anova_lm_h3b) |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(dplyr::filter(df_h3b, self_other == "other")$participant_role)
lm_h3b_role_emm <- emmeans::emmeans(lm_h3b, specs = ~participant_role)
lm_h3b_role_emm |> as.data.frame()

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Participant Role: B - C
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h3b_role_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# ------------------------------- #
# EFFECT SIZE FOR MEAN COMPARISON #
# ------------------------------- #
# Participant Role: B - C (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h3b_role_emm, 
    sigma  = sigma(lm_h3b), 
    edf    = df.residual(lm_h3b)))
```

#### Curvilinear Model

```{r hypothesis-3b-qm, message=F, warning=F}
#| lst-label: h3b-qm
#| lst-cap: H3 Morality Rating Quadratic Model
# --------------- #
# QUADRATIC MODEL #
# --------------- #
qm_h3b <- lm(
  formula   = morality_rating ~ participant_role + transfer + I(transfer^2), 
  data      = dplyr::filter(df_h3b, self_other == "other"),
  contrasts = list(participant_role = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_qm_h3b <- car::Anova(qm_h3b, type = 3)
parameters::model_parameters(anova_qm_h3b)
effectsize::effectsize(anova_qm_h3b) |> as.data.frame()

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(qm_h3b, ~1, var = "transfer", max.degree = 2))

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(dplyr::filter(df_h3b, self_other == "other")$participant_role)
qm_h3b_role_emm <- emmeans::emmeans(qm_h3b, specs = ~participant_role) 
qm_h3b_role_emm |> as.data.frame()

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Participant Role: B - C
parameters::model_parameters(
  emmeans::contrast(
    object = qm_h3b_role_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# ------------------------------- #
# EFFECT SIZE FOR MEAN COMPARISON #
# ------------------------------- #
# Participant Role: B - C (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = qm_h3b_role_emm, 
    sigma  = sigma(qm_h3b), 
    edf    = df.residual(qm_h3b)))
```

#### Data Visualization

```{r hypothesis-3b-visualize, message=F, warning=F}
#| lst-label: h3b-data-vis
#| lst-cap: H3 Morality Rating Data Visualization

# Axis Labels
h3b_vis_x_title <- paste0(
  "Dictator Game Send ($) (A ", IconWrapper("\uf178"), " B)")

h3b_vis_y_title <- paste0(
  "Dictator Game Actor Morality (Rating) (A ", IconWrapper("\uf178"), " B)")

set.seed(42)
qm_h3b_vis <- emmeans::emmeans(
  qm_h3b,
  specs    = ~participant_role,
  cov.keep = "transfer",
  at       = list(transfer = seq(0, 0.50, by = 0.01)),
  by       = "transfer") |>
  as.data.frame() |>
  janitor::clean_names('snake') |>
  ggplot2::ggplot(
    ggplot2::aes(
      x     = transfer,
      y     = emmean,
      shape = participant_role,
      fill  = participant_role,
      color = participant_role)) +
  
  ggplot2::geom_point(
    ggplot2::aes(
      x = transfer_jittered,
      y = morality_rating_jittered),
    data = df_h3b |> 
      dplyr::filter(self_other == "other") |> 
      dplyr::mutate(
        transfer_jittered = pmax(
          0.01, 
          pmin(0.50 - 0.01, 
               transfer + runif(n(), -0.075, 0.075))),
        morality_rating_jittered = pmax(
          2, 
          pmin(100 - 2,
               morality_rating + runif(n(), -5, 5)))),
    stroke = 0, alpha = 0.5, size = 0.5) +
  
  theme_aps() +
  ggplot2::geom_line(alpha = 1, linewidth = .5) +
  ggplot2::geom_ribbon(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl),
    alpha = .4, linewidth = 0) +
  ggplot2::labs(
    x     = h3b_vis_x_title,
    y     = h3b_vis_y_title,
    shape = "Observer Role",
    fill  = "Observer Role",
    color = "Observer Role") +
  ggplot2::scale_fill_manual(values = c("#56A319", "#F063A7")) +
  ggplot2::scale_color_manual(values = c("#56A319", "#F063A7")) +
  ggplot2::scale_shape_manual(values = c("square", "circle")) +
  ggplot2::scale_y_continuous(
    expand = c(0, 0),
    limits = c(0, 100), 
    breaks = seq(0, 100, by = 25), 
    minor_breaks = NULL) +
  ggplot2::scale_x_continuous(
    expand = c(0, 0),
    labels = c("0", "0.10", "0.20", "0.30", "0.40", "0.50")) +
  ggplot2::coord_cartesian(xlim = c(0, 0.50), ylim = c(0, 100), clip = "off") +
  ggplot2::theme(
    axis.title.x = element_markdown(),
    axis.title.y = element_markdown(),
    plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"))

# Display Figure
qm_h3b_vis

# Save Figure
ggplot2::ggsave(
  filename = here::here("main/figures/hypothesis-3b-data-vis.png"),
  plot     = qm_h3b_vis, 
  width    = 3.8, 
  height   = 4, 
  dpi      = 300)

# Delete Figure Object and Axis Titles
# rm(h3b_vis, h3b_vis_x_title, h3b_vis_y_title)
```

------------------------------------------------------------------------

## H4: "Discounted as Signal"

### Modeling Game Behavior

#### Prep Data

```{r hypothesis-4a-prep-data, message=F, warning=F}
#| lst-label: h4-prep-data
#| lst-cap: H4 Game Behavior Data Preparation
# --------- #
# PREP DATA #
# --------- #
df_h4a <- df_complete |>
  dplyr::filter(!stringr::str_starts(participant_role, "B")) |>
  dplyr::select(
    unique_group_id, participant_role, 
    public_private, partner_choice,
    dg_a_chosen_transfer, tg_c_transfer) |> 
  dplyr::group_by(unique_group_id) |> 
  dplyr::mutate(
    dg_a_chosen_transfer = dplyr::if_else(
      is.na(dg_a_chosen_transfer), 
      dplyr::first(na.omit(dg_a_chosen_transfer)), 
      dg_a_chosen_transfer),
    tg_c_transfer = dplyr::if_else(
      is.na(tg_c_transfer), 
      dplyr::first(na.omit(tg_c_transfer)), 
      tg_c_transfer)) |> 
  dplyr::ungroup() |>
  dplyr::distinct(unique_group_id, .keep_all = T) |> 
  dplyr::arrange(unique_group_id, participant_role)
```

#### Linear Model

```{r hypothesis-4a-lm, message=F, warning=F}
#| lst-label: h4-lm
#| lst-cap: H4 Game Behavior Linear Model
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h4a <- lm(
  formula   = tg_c_transfer ~ public_private 
  + partner_choice 
  + dg_a_chosen_transfer,
  data      = df_h4a,
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_h4a <- car::Anova(lm_h4a, type = 3)
parameters::model_parameters(anova_lm_h4a)
effectsize::effectsize(anova_lm_h4a) |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# table(df_h4a$public_private)
lm_h4a_obs_emm <- emmeans::emmeans(lm_h4a, specs = ~public_private)
lm_h4a_obs_emm |> as.data.frame()

# table(df_h4a$partner_choice)
lm_h4a_pc_emm  <- emmeans::emmeans(lm_h4a, specs = ~partner_choice)
lm_h4a_pc_emm |> as.data.frame()

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(lm_h4a, ~1, var = "dg_a_chosen_transfer"))

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h4a_obs_emm, 
    method = "pairwise",
    infer  = T, 
    adjust = "none"))

# Partner Choice: Yes - No
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h4a_pc_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h4a_obs_emm, 
    sigma  = sigma(lm_h4a), 
    edf    = df.residual(lm_h4a)))

# Partner Choice: Yes - No (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    lm_h4a_pc_emm, 
    sigma = sigma(lm_h4a), 
    edf   = df.residual(lm_h4a)))
```

#### Curvilinear Model

```{r hypothesis-4a-qm, message=F, warning=F}
#| lst-label: h4-qm
#| lst-cap: H4 Game Behavior Quadratic Model
# --------------- #
# QUADRATIC MODEL #
# --------------- #
qm_h4a <- lm(
  formula   = tg_c_transfer ~ public_private
  + partner_choice 
  + dg_a_chosen_transfer 
  + I(dg_a_chosen_transfer^2), 
  data      = df_h4a,
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(qm_h4a, ~1, var = "dg_a_chosen_transfer", max.degree = 2))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_qm_h4a <- car::Anova(qm_h4a, type = 3)
parameters::model_parameters(anova_qm_h4a)
effectsize::effectsize(anova_qm_h4a) |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# table(df_h4a$public_private)
# Observability: Public - Private
qm_h4a_obs_emm <- emmeans::emmeans(qm_h4a, specs = ~public_private) 
qm_h4a_obs_emm |> as.data.frame()

# Partner Choice: Yes - No
qm_h4a_pc_emm  <- emmeans::emmeans(qm_h4a, specs = ~partner_choice)
qm_h4a_pc_emm |> as.data.frame()

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = qm_h4a_obs_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# Partner Choice: Yes - No
parameters::model_parameters(
  emmeans::contrast(
    object = qm_h4a_pc_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = qm_h4a_obs_emm, 
    sigma  = sigma(qm_h4a), 
    edf    = df.residual(qm_h4a)))

# Partner Choice: Yes - No (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = qm_h4a_pc_emm, 
    sigma  = sigma(qm_h4a), 
    edf    = df.residual(qm_h4a)))
```

#### Data Visualization

```{r hypothesis-4a-visualize, message=F, warning=F}
#| lst-label: h4a-data-vis
#| lst-cap: H4 Game Behavior Data Visualization
h4a_vis_x_title <- paste0(
  "Dictator Game Send ($) (A ", IconWrapper("\uf178"), " B)")

h4a_vis_y_title <- paste0(
  "Trust Game Send ($) (C ", IconWrapper("\uf178"), " A)")

set.seed(42)
qm_h4a_vis <- emmeans::emmeans(
  qm_h4a,
  specs    = ~public_private:partner_choice,
  cov.keep = "dg_a_chosen_transfer",
  at       = list(dg_a_chosen_transfer = seq(0, 0.50, by = 0.01)),
  by       = "dg_a_chosen_transfer") |>
  as.data.frame() |>
  janitor::clean_names('snake') |>
  dplyr::mutate(
    public_private = dplyr::case_when(
      public_private == "public"  ~ "Public",
      public_private == "private" ~ "Private"),
    partner_choice = dplyr::case_when(
      partner_choice == "no"  ~ "No",
      partner_choice == "yes" ~ "Yes")) |>
  ggplot2::ggplot(
    ggplot2::aes(
      x        = dg_a_chosen_transfer,
      y        = emmean,
      linetype = public_private,
      fill     = partner_choice,
      color    = partner_choice)) +
  
  ggplot2::geom_point(
    ggplot2::aes(
      x = dg_a_chosen_transfer_jittered,
      y = tg_c_transfer_jittered),
    data = df_h4a |> 
      dplyr::mutate(
        dg_a_chosen_transfer_jittered = pmax(
          0.01, 
          pmin(0.50 - 0.01, 
               dg_a_chosen_transfer + runif(n(), -0.025, 0.025))),
        tg_c_transfer_jittered = pmax(
          0.01, 
          pmin(0.50 - 0.01,
               tg_c_transfer + runif(n(), -0.025, 0.025))),
        public_private = dplyr::case_when(
          public_private == "public"  ~ "Public",
          public_private == "private" ~ "Private"),
        partner_choice = dplyr::case_when(
          partner_choice == "no"  ~ "No",
          partner_choice == "yes" ~ "Yes")),
    stroke = 0, alpha = 0.5, size = 1) +
  ggplot2::geom_line(alpha = 1, size = .5) +
  ggplot2::geom_ribbon(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl), alpha = 0.2, linewidth = 0) +
  ggplot2::labs(
    x     = h4a_vis_x_title,
    y     = h4a_vis_y_title,
    fill  = "Partner Choice",
    color = "Partner Choice") +
  ggplot2::facet_wrap(~public_private) +
  ggplot2::scale_y_continuous(
    expand = c(0, 0),
    labels = c("0", "0.10", "0.20", "0.30", "0.40", "0.50")) +
  ggplot2::scale_x_continuous(
    expand = c(0, 0),
    labels = c("0", "0.10", "0.20", "0.30", "0.40", "0.50")) +
  ggplot2::scale_linetype_manual(
    values = c("Public" = "solid", "Private" = "2222")) +
  ggplot2::scale_color_manual(values = c("#D55E00", "#0072B2")) +
  ggplot2::scale_fill_manual(values = c("#D55E00", "#0072B2")) +
  ggplot2::scale_shape_manual(values = c("square", "circle")) +
  ggplot2::coord_cartesian(xlim = c(0, 0.5), ylim = c(0, 0.5), clip = "off") +
  theme_aps() +
  ggplot2::theme(
    panel.spacing = unit(0.75, "cm"),
    plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm")) +
  ggplot2::guides(linetype = "none")

# Display Figure
qm_h4a_vis

# Save Figure
ggplot2::ggsave(
  filename = here::here("main/figures/hypothesis-4a-data-vis.png"), 
  plot     = qm_h4a_vis, 
  width    = 6, 
  height   = 4, 
  dpi      = 300)

# Delete Figure Object and Axis Titles
# rm(qm_h4a_vis, h4a_vis_x_title, h4a_vis_y_title)
```

### Modeling Morality Ratings

#### Prep Data

```{r hypothesis-4b-prep-data, message=F, warning=F}
# --------- #
# PREP DATA #
# --------- #
df_h4b <- df_h3b
```

#### Linear Model

```{r hypothesis-4b-lm, message=F, warning=F}
#| lst-label: h4b-lm
#| lst-cap: H4 Morality Rating Linear Model
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h4b <- lm(  # subsetting on "other"
  formula   = morality_rating ~ (public_private * partner_choice) + transfer, 
  data      = dplyr::filter(df_h4b, self_other == "other"), 
  contrasts = list(
    partner_choice = "contr.sum",
    public_private = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_h4b <- car::Anova(lm_h4b, type = 3)
parameters::model_parameters(anova_h4b)
effectsize::effectsize(anova_h4b) |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(dplyr::filter(df_h4b, self_other == "other")$public_private)
lm_h4b_obs_emm <- emmeans::emmeans(lm_h4b, specs = ~public_private) 
lm_h4b_obs_emm |> as.data.frame()

table(dplyr::filter(df_h4b, self_other == "other")$partner_choice)
lm_h4b_pc_emm  <- emmeans::emmeans(lm_h4b, specs = ~partner_choice) 
lm_h4b_pc_emm |> as.data.frame()

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h4b_obs_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# Partner Choice: No - Yes
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h4b_pc_emm, 
    method = "pairwise",
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h4b_obs_emm, 
    sigma  = sigma(lm_h4b), 
    edf    = df.residual(lm_h4b)))

# Partner Choice: No - Yes (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h4b_pc_emm, 
    sigma  = sigma(lm_h4b), 
    edf    = df.residual(lm_h4b)))
```

#### Curvilinear Model

```{r hypothesis-4b-qm, message=F, warning=F}
#| lst-label: h4b-qm
#| lst-cap: H4 Morality Rating Quadratic Model
# --------------- #
# QUADRATIC MODEL #
# --------------- #
qm_h4b <- lm(  # subsetting on "other"
  formula   = morality_rating ~ (public_private * partner_choice) + 
    transfer + I(transfer^2), 
  data      = dplyr::filter(df_h4b, self_other == "other"),
  contrasts = list(
    partner_choice = "contr.sum", 
    public_private = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_qm_h4b <- car::Anova(qm_h4b, type = 3)
parameters::model_parameters(anova_qm_h4b)
effectsize::effectsize(anova_qm_h4b) |> as.data.frame()

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(qm_h4b, ~1, var = "transfer", max.degree = 2))

# ---------------------- #
# INTERACTION DECOMPOSED #
# ---------------------- #
# Other & Private
lm_h4b_intcov_other_private <- lm(
  formula   = morality_rating ~ partner_choice + transfer,
  data      = dplyr::filter(df_h4b, self_other == "other" & public_private == "private"),
  contrasts = list(partner_choice = "contr.sum"))
car::Anova(lm_h4b_intcov_other_private, type = 3)

# Other & Public
lm_h4b_intcov_other_public <- lm(
  formula   = morality_rating ~ partner_choice + transfer,
  data      = dplyr::filter(df_h4b, self_other == "other" & public_private == "public"),
  contrasts = list(partner_choice = "contr.sum"))
car::Anova(lm_h4b_intcov_other_public, type = 3)
```

#### Data Visualization

```{r hypothesis-4b-visualize, message=F, warning=F}
#| lst-label: h4b-data-vis
#| lst-cap: H4 Morality Rating Data Visualization

# Axis Labels
h4b_vis_x_title <- paste0(
  "Dictator Game Send ($) (A ", IconWrapper("\uf178"), " B)")

h4b_vis_y_title <- paste0(
  "Dictator Game Actor Morality (Rating) (A ", IconWrapper("\uf178"), " B)")

set.seed(42)
h4b_vis <- emmeans::emmeans(
  qm_h4b,
  specs    = ~public_private:partner_choice,
  cov.keep = "transfer",
  at       = list(transfer = seq(0, 0.50, by = 0.01)),
  by       = "transfer") |>
  as.data.frame() |>
  janitor::clean_names('snake') |>
  dplyr::mutate(
    public_private = dplyr::case_when(
      public_private == "public"  ~ "Public",
      public_private == "private" ~ "Private"),
    partner_choice = dplyr::case_when(
      partner_choice == "no"  ~ "No",
      partner_choice == "yes" ~ "Yes")) |>
  ggplot2::ggplot(
    ggplot2::aes(
      x        = transfer,
      y        = emmean,
      linetype = public_private,
      fill     = partner_choice,
      color    = partner_choice)) +
  
  ggplot2::geom_point(
    ggplot2::aes(
      x = transfer_jittered,
      y = morality_rating_jittered),
    data = df_h4b |> 
      # dplyr::filter(self_other == "other") |> 
      dplyr::mutate(
        transfer_jittered = pmax(
          0.01, 
          pmin(0.50 - 0.01, 
               transfer + runif(n(), -0.025, 0.025))),
        morality_rating_jittered = pmax(
          2, 
          pmin(100 - 2,
               morality_rating + runif(n(), -5, 5))),
        public_private = dplyr::case_when(
          public_private == "public"  ~ "Public",
          public_private == "private" ~ "Private"),
        partner_choice = dplyr::case_when(
          partner_choice == "no"  ~ "No",
          partner_choice == "yes" ~ "Yes")),
    stroke = 0, alpha = 0.5, size = 0.5) +
  ggplot2::geom_line(alpha = 1, size = .5) +
  ggplot2::geom_ribbon(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl), alpha = .3, size = 0) +
  ggplot2::labs(
    x     = h4b_vis_x_title,
    y     = h4b_vis_y_title,
    shape = "Partner Choice",
    fill  = "Partner Choice",
    color = "Partner Choice") +
  ggplot2::facet_wrap(~public_private) +
  ggplot2::scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  ggplot2::scale_linetype_manual(
    values = c("Public" = "solid", "Private" = "2222")) +
  ggplot2::scale_color_manual(values = c("#D55E00", "#0072B2")) +
  ggplot2::scale_fill_manual(values = c("#D55E00", "#0072B2")) +
  ggplot2::scale_shape_manual(values = c("square", "circle")) +
  theme_aps() +
  ggplot2::theme(
    panel.spacing = unit(0.75, "cm"),
    plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm")) +
  ggplot2::guides(linetype = "none") +
  ggplot2::scale_y_continuous(
    expand = c(0, 0),
    limits = c(0, 100), 
    breaks = seq(0, 100, by = 25), minor_breaks = NULL) +
  ggplot2::scale_x_continuous(
    expand = c(0, 0),
    labels = c("0", "0.10", "0.20", "0.30", "0.40", "0.50")) +
  ggplot2::coord_cartesian(xlim = c(0, 0.50), ylim = c(0, 100), clip = "off")

# Display Figure
h4b_vis

# Save Figure and Delete Object
ggplot2::ggsave(
  filename = here::here("main/figures/hypothesis-4b-data-vis.png"),
  plot     = h4b_vis,
  width    = 6,
  height   = 4,
  dpi      = 300)

# Delete Figure Object and Axis Titles
# rm(h4b_vis, h4b_vis_x_title, h4b_vis_y_title)
```

------------------------------------------------------------------------

## X5: Exploratory Self/Other Analyses

### Modeling Morality Ratings

#### Prep Data

```{r exploratory-5-prep-data, message=F, warning=F}
# --------- #
# PREP DATA #
# --------- #
df_x5 <- df_h4b |> 
  dplyr::mutate(
    transfer_meancentered = scale(transfer, scale = F), .after = transfer)
```

#### Linear Model

```{r exploratory-5-lm, message=F, warning=F}
#| lst-label: x5-lm
#| lst-cap: X5 Morality Rating Linear Model
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_x5 <- lm(
  formula   = morality_rating ~ self_other * transfer_meancentered, 
  data      = df_x5,
  contrasts = list(self_other = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_x5 <- car::Anova(lm_x5, type = 3)
parameters::model_parameters(anova_lm_x5)
effectsize::effectsize(anova_lm_x5) |> as.data.frame()

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(lm_x5, ~1, var = "transfer_meancentered"))

lm_x5_so_emt <- emmeans::emtrends(
  lm_x5, ~self_other, var = "transfer_meancentered")
lm_x5_so_emt |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(df_x5$self_other)
lm_x5_so_emm <- emmeans::emmeans(lm_x5, specs = ~self_other)
lm_x5_so_emm |> as.data.frame()

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Perspective: Self - Other
parameters::model_parameters(
  emmeans::contrast(
    object = lm_x5_so_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

parameters::model_parameters(
  emmeans::contrast(
    object = lm_x5_so_emt, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Perspective: Self - Other (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_x5_so_emm, 
    sigma  = sigma(lm_x5), 
    edf    = df.residual(lm_x5)))

# ---------------------- #
# INTERACTION DECOMPOSED #
# ---------------------- #
lm_x5_self <- lm(
  formula = morality_rating ~ transfer_meancentered, 
  data    = df_x5 |> dplyr::filter(self_other == "self"))
parameters::model_parameters(lm_x5_self)

lm_x5_other <- lm(
  formula = morality_rating ~ transfer_meancentered, 
  data    = df_x5 |> dplyr::filter(self_other == "other"))
parameters::model_parameters(lm_x5_other)
```

#### Curvilinear Model

```{r exploratory-5-qm, message=F, warning=F} 
#| lst-label: x5-qm
#| lst-cap: X5 Morality Rating Quadratic Model
# --------------- #
# QUADRATIC MODEL #
# --------------- #
qm_x5 <- lm(
  formula   = morality_rating ~ self_other * 
    (transfer_meancentered + I(transfer_meancentered^2)), 
  data      = df_x5,
  contrasts = list(self_other = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_qm_x5 <- car::Anova(qm_x5, type = 3)
parameters::model_parameters(anova_qm_x5)
effectsize::effectsize(anova_qm_x5) |> as.data.frame()

# ---------------------- #
# AVERAGE MARGINAL TREND #
# ---------------------- #
parameters::model_parameters(
  emmeans::emtrends(qm_x5, ~1, var = "transfer_meancentered", max.degree = 2))

qm_x5_so_emt <- emmeans::emtrends(
  qm_x5, ~self_other, var = "transfer_meancentered")
parameters::model_parameters(qm_x5_so_emt)

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# table(df_x5$self_other)
qm_x5_so_emm <- emmeans::emmeans(qm_x5, specs = ~self_other)
parameters::model_parameters(qm_x5_so_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Perspective: Self - Other
parameters::model_parameters(
  emmeans::contrast(
    object = qm_x5_so_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

parameters::model_parameters(
  emmeans::contrast(
    object = qm_x5_so_emt, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Perspective: Self - Other (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = qm_x5_so_emm, 
    sigma  = sigma(qm_x5), 
    edf    = df.residual(qm_x5)))
```

#### Data Visualization

```{r exploratory-data-vis, message=F, warning=F}
#| lst-label: x5-data-vis
#| lst-cap: X5 Morality Rating Data Visualization
# ---------------------------- #
# QUADRATIC MODEL FOR PLOTTING #
# ---------------------------- #
# We do not care about mean centering for visualization purposes
qm_x5_vis <- lm(
  formula   = morality_rating ~ self_other * (transfer + I(transfer^2)), 
  data      = df_x5, 
  contrasts = list(self_other = "contr.sum"))

x5_vis_x_title <- paste0(
  "Dictator Game Send ($) (A ", IconWrapper("\uf178"), " B)")

x5_vis_y_title <- paste0(
  "Dictator Game Actor Morality (Rating) (A ", IconWrapper("\uf178"), " B)")

set.seed(42)
x5_vis <- emmeans::emmeans(
  qm_x5_vis,
  specs    = ~self_other,
  cov.keep = "transfer",
  at       = list(transfer = seq(0, 0.50, by = 0.01)),
  by       = "transfer") |>
  as.data.frame() |>
  janitor::clean_names('snake') |>
  dplyr::mutate(
    self_other = forcats::fct_relevel(
      dplyr::case_when(
        self_other == "self"  ~ "Self",
        self_other == "other" ~ "Other"),
      c("Self", "Other"))) |>
  ggplot2::ggplot(
    ggplot2::aes(
      x     = transfer,
      y     = emmean,
      shape = self_other,
      fill  = self_other,
      color = self_other)) +
  
  ggplot2::geom_point(
    ggplot2::aes(
      x = transfer_jittered,
      y = morality_rating_jittered),
    data = df_x5 |> 
      dplyr::mutate(
        transfer_jittered = pmax(
          0.01, 
          pmin(0.50 - 0.01, 
               transfer + runif(n(), -0.025, 0.025))),
        morality_rating_jittered = pmax(
          2, 
          pmin(100 - 2,
               morality_rating + runif(n(), -5, 5))),
        self_other = dplyr::case_when(
          self_other == "self"  ~ "Self",
          self_other == "other" ~ "Other")),
    stroke = 0, alpha = 0.5, size = 0.5) +
  ggplot2::geom_line(alpha = 1, linewidth = 0.5) +
  ggplot2::geom_ribbon(
    ggplot2::aes(ymin = lower_cl, ymax = upper_cl), alpha = .3, linewidth = 0) +
  ggplot2::labs(
    x     = x5_vis_x_title,
    y     = x5_vis_y_title,
    shape = "Rater Perspective",
    fill  = "Rater Perspective",
    color = "Rater Perspective") +
  ggplot2::scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  ggplot2::scale_color_manual(values = c("#0072B2", "#D55E00")) +
  ggplot2::scale_fill_manual(values = c("#0072B2", "#D55E00")) +
  ggplot2::scale_shape_manual(values = c("circle", "square")) +
  theme_aps() +
  ggplot2::theme(
    plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm")) +
  ggplot2::guides(linetype = "none") +
  ggplot2::scale_y_continuous(
    expand = c(0, 0),
    limits = c(0, 100), breaks = seq(0, 100, by = 25), minor_breaks = NULL) +
  ggplot2::scale_x_continuous(
    expand = c(0, 0),
    labels = c("0", "0.10", "0.20", "0.30", "0.40", "0.50")) +
  ggplot2::coord_cartesian(xlim = c(0, 0.50), ylim = c(0, 100), clip = "off")

# Display Figure
x5_vis

# Save Figure
ggplot2::ggsave(
  filename = here::here("main/figures/exploratory-5-data-vis.png"),
  plot     = x5_vis,
  width    = 3.8,
  height   = 4,
  dpi      = 300)

# Delete Object
rm(x5_vis)
```

------------------------------------------------------------------------

# Supplementary Information

## 1 Preregistered Analyses

### 1.1 Preregistered H1 (H1 in Main Paper)

Independent-Samples T-Test

```{r hypothesis-1-prereg-t-test, message=F, warning=F}
#| lst-label: pre1-ttest
#| lst-cap: Preregistered H1 Dictator Game Generosity T-Test
# --------- #
# PREP DATA #
# --------- #
df_pre1 <- df_complete |> 
  dplyr::select(
    participant_role, public_private, partner_choice, dg_a_gen_transfer) |> 
  dplyr::filter(stringr::str_starts(participant_role, "A")) |> 
  tidyr::drop_na(dg_a_gen_transfer) |> 
  dplyr::mutate(public_private = forcats::fct_relevel(public_private, "public"))

# -------------------------- #
# INDEPENDENT-SAMPLES T-TEST #
# -------------------------- #
ttest_pre1 <- t.test(
  formula     = dg_a_gen_transfer ~ public_private, 
  data        = df_pre1, 
  alternative = "greater")
parameters::model_parameters(ttest_pre1)
effectsize::effectsize(ttest_pre1)

# ------------ #
# LINEAR MODEL #
# ------------ #
lm_pre1 <- lm(
  formula   = dg_a_gen_transfer ~ public_private, 
  data      = df_pre1, 
  contrasts = list(public_private = "contr.sum"))

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(df_pre1$public_private)
# Observability: Public - Private
parameters::model_parameters(
  emmeans::emmeans(lm_pre1, specs = ~public_private))
```

### 1.2 Preregistered H2 (H4 in Main Paper)

Linear Regression

Comparing initial trustor generosity in the TG by observability controlling for
generosity in the DG.

```{r hypothesis-2-prereg-lm, message=F, warning=F}
#| lst-label: pre2-lm
#| lst-cap: Preregistered H2 Trust Game Generosity Linear Model
# --------- #
# PREP DATA #
# --------- #
df_pre2 <- df_h4a

# ------------ #
# LINEAR MODEL #
# ------------ #
lm_pre2a <- lm(
  formula   = tg_c_transfer ~ public_private + dg_a_chosen_transfer, 
  data      = df_pre2, 
  contrasts = list(public_private = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_pre2a <- car::Anova(lm_pre2a, type = 3)
parameters::model_parameters(lm_pre2a)
effectsize::effectsize(lm_pre2a)

lm_pre2a_obs_emm <- emmeans::emmeans(lm_pre2a, specs = ~public_private)
parameters::model_parameters(lm_pre2a_obs_emm)

# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_pre2a_obs_emm, 
    method = "pairwise", 
    infer  = T, 
    adj    = "none"))

# ------------ #
# LINEAR MODEL #
# ------------ #
# As an additional test, do not control for DG generosity
lm_pre2b <- lm(
  formula   = tg_c_transfer ~ public_private, 
  data      = df_pre2, 
  contrasts = list(public_private = "contr.sum"))

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(df_pre2$public_private)
lm_pre2b_obs_emm <- emmeans::emmeans(lm_pre2b, specs = ~public_private)
parameters::model_parameters(lm_pre2b_obs_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_pre2b_obs_emm, 
    method = "pairwise", 
    infer  = T, 
    adj    = "none"))

# ------------------------------- #
# EFFECT SIZE FOR MEAN COMPARISON #
# ------------------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_pre2b_obs_emm, 
    sigma  = sigma(lm_pre2b), 
    edf    = df.residual(lm_pre2b)))
```

### Preregistered H3 (Not in Main Text)

Linear Regression

```{r hypothesis-3-prereg-lm, message=F, warning=F}
#| lst-label: pre3-lm
#| lst-cap: Preregistered H3 Dictator Game Transfer Difference Linear Model
# --------- #
# PREP DATA #
# --------- #
df_pre3 <- df_complete |>
  dplyr::filter((participant_role == "C") & (partner_choice == "yes")) |> 
  dplyr::select(
    participant_role, tg_partner_choice, dg_a1_transfer, dg_a2_transfer) |> 
  dplyr::mutate(dg_transfer_difference = dg_a2_transfer - dg_a1_transfer)

# ------------ #
# LINEAR MODEL #
# ------------ #
lm_pre3 <- lm(
  formula    = dg_transfer_difference ~ tg_partner_choice, 
  data       = df_pre3, 
  contrasts  = list(tg_partner_choice = "contr.sum"))

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
lm_pre3_tg_pc_emm <- emmeans::emmeans(lm_pre3, specs = ~tg_partner_choice)
parameters::model_parameters(lm_pre3_tg_pc_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Partner Choice: A1 - A2
parameters::model_parameters(
  emmeans::contrast(
    object = lm_pre3_tg_pc_emm, 
    method = "pairwise", 
    infer  = T, 
    adj    = "none"))

# ------------------------------- #
# EFFECT SIZE FOR MEAN COMPARISON #
# ------------------------------- #
# Partner Choice: A1 - A2 (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_pre3_tg_pc_emm, 
    sigma  = sigma(lm_pre3), 
    edf    = df.residual(lm_pre3)))
```

### 1.3 Preregistered H4 (H3 in Main Paper)

Linear Regression

@h3-prereg-lm
@h3-morality-lm

### 1.4 Preregistered H5 (H2 in Main Paper)

Linear Regression

The transfer difference is more negative (A2 gave more than A1) when A2 is 
picked -- in other words, A2 is picked when they give more than A1.

```{r hypothesis-5-prereg-lm, message=F, warning=F}
#| lst-label: pre5-lm
#| lst-cap: Preregistered H5 Trust Game Return Ratio Linear Model
# --------- #
# PREP DATA #
# --------- #
df_pre5 <- df_h2

# ------------ #
# LINEAR MODEL #
# ------------ #
lm_pre5 <- lm(
  formula = tg_a_return_ratio ~ dg_a_chosen_transfer_ratio, 
  data    = df_pre5)

parameters::model_parameters(lm_pre5)
```

------------------------------------------------------------------------

## 2 Exploratory Interaction Models

### 2.1 H1x: Exploratory Interaction Model

```{r hypothesis-1-interaction-model, message=F, warning=F}
#| lst-label: h1x-lm
#| lst-cap: Exploratory H1 Interaction Model
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h1X <- lm(
  formula   = dg_a_gen_transfer ~ public_private * partner_choice, 
  data      = df_h1,
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_h1X <- car::Anova(lm_h1X, type = 3)
parameters::model_parameters(anova_lm_h1X)
effectsize::effectsize(anova_lm_h1X)

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# Observability: Public - Private
table(df_h1$public_private)
lm_h1X_obs_emm <- emmeans::emmeans(lm_h1X, specs = ~public_private)
parameters::model_parameters(lm_h1X_obs_emm)

# Partner Choice: Yes - No
table(df_h1$partner_choice)
lm_h1X_pc_emm  <- emmeans::emmeans(lm_h1X, specs = ~partner_choice)
parameters::model_parameters(lm_h1X_pc_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h1X_obs_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# Partner Choice: Yes - No
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h1X_pc_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h1X_obs_emm, 
    sigma  = sigma(lm_h1X), 
    edf    = df.residual(lm_h1X)))

# Partner Choice: Yes - No (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h1X_pc_emm, 
    sigma  = sigma(lm_h1X), 
    edf    = df.residual(lm_h1X)))
```

### 2.2 H2aX: Exploratory Interaction Model

```{r hypothesis-2a-interaction-models, message=F, warning=F}
#| lst-label: h2ax-lm-qm
#| lst-cap: Exploratory H2a Interaction Models
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h2aX <- lm(
  formula   = tg_a_return_ratio ~ (public_private * partner_choice) 
  + dg_a_chosen_transfer_ratio, 
  data      = df_h2, 
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# --------------- #
# QUADRATIC MODEL #
# --------------- #
qm_h2aX <- lm(
  formula   = tg_a_return_ratio ~ (public_private * partner_choice) 
  + dg_a_chosen_transfer_ratio 
  + I(dg_a_chosen_transfer_ratio^2),
  data      = df_h2, 
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_lm_h2aX <- car::Anova(lm_h2aX, type = 3)
parameters::model_parameters(anova_lm_h2aX)
effectsize::effectsize(anova_lm_h2aX) |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# Observability: Public - Private
table(df_h2$public_private)
lm_h2aX_obs_emm <- emmeans::emmeans(lm_h2aX, specs = ~public_private)
parameters::model_parameters(lm_h2aX_obs_emm)

# Partner Choice: Yes - No
table(df_h2$partner_choice)
lm_h2aX_pc_emm  <- emmeans::emmeans(lm_h2aX, specs = ~partner_choice)
parameters::model_parameters(lm_h2aX_pc_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Observability: Public - Private
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h2aX_obs_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# Partner Choice: Yes - No
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h2aX_pc_emm, 
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Observability: Public - Private (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h2aX_obs_emm, 
    sigma  = sigma(lm_h2aX), 
    edf    = df.residual(lm_h2aX)))

# Partner Choice: Yes - No (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h2aX_pc_emm, 
    sigma  = sigma(lm_h2aX), 
    edf    = df.residual(lm_h2aX)))
```

### 2.3 H3bX: Exploratory Interaction Model

```{r hypothesis-3b-interaction-models, message=F, warning=F}
#| lst-label: h3bx-lm-qm
#| lst-cap: Exploratory H3b Interaction Models
# ------------ #
# LINEAR MODEL #
# ------------ #
df_h3bX <- df_h3b |> 
  dplyr::mutate(
    transfer_meancentered = scale(transfer, scale = F), .after = transfer) |> 
  dplyr::filter(self_other == "other")

lm_h3bX <- lm(
  formula   = morality_rating ~ transfer_meancentered * participant_role, 
  data      = df_h3bX,
  contrasts = list(participant_role = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_h3bX <- car::Anova(lm_h3bX, type = 3)
parameters::model_parameters(anova_h3bX)
effectsize::effectsize(anova_h3bX) |> as.data.frame()

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
table(df_h3bX$participant_role)
lm_h3bX_role_emm <- emmeans::emmeans(lm_h3bX, specs = ~participant_role)
parameters::model_parameters(lm_h3bX_role_emm)

# ------------------- #
# PAIRWISE COMPARISON #
# ------------------- #
parameters::model_parameters(
  emmeans::contrast(
    lm_h3bX_role_emm, method = "pairwise", infer = T, adjust = "none"))

# ------------------------------- #
# EFFECT SIZE FOR MEAN COMPARISON #
# ------------------------------- #
# Participant Role: B - C (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h3bX_role_emm, 
    sigma  = sigma(lm_h3bX), 
    edf    = df.residual(lm_h3bX)))

# --------------- #
# QUADRATIC MODEL #
# --------------- #
lm_h3bX_curv <- lm(
  formula   = morality_rating ~ (transfer + I(transfer^2)) * participant_role, 
  data      = dplyr::filter(df_h3b, self_other == "other"),
  contrasts = list(participant_role = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_h3bX_curv <- car::Anova(lm_h3bX_curv, type = 3)
parameters::model_parameters(anova_h3bX_curv)
effectsize::effectsize(anova_h3bX_curv)

# ------------------------ #
# ESTIMATED MARGINAL MEANS #
# ------------------------ #
# table(df_h3b$participant_role)

lm_h3bX_curv_role_emm <- emmeans::emmeans(
  lm_h3bX_curv, specs = ~participant_role)
parameters::model_parameters(lm_h3bX_curv_role_emm)

# -------------------- #
# PAIRWISE COMPARISONS #
# -------------------- #
# Participant Role: B - C
parameters::model_parameters(
  emmeans::contrast(
    object = lm_h3bX_curv_role_emm,
    method = "pairwise", 
    infer  = T, 
    adjust = "none"))

# --------------------------------- #
# EFFECT SIZES FOR MEAN COMPARISONS #
# --------------------------------- #
# Participant Role: B - C (Cohen's d)
parameters::model_parameters(
  emmeans::eff_size(
    object = lm_h3bX_curv_role_emm, 
    sigma  = sigma(lm_h3bX_curv), 
    edf    = df.residual(lm_h3bX_curv)))
```

### 2.4 H4aX: Exploratory Interaction Model

```{r hypothesis-4a-interaction-model, message=F, warning=F}
# ------------ #
# LINEAR MODEL #
# ------------ #
lm_h4X <- lm(
  formula   = tg_c_transfer ~ (public_private * partner_choice) 
  + dg_a_chosen_transfer, 
  data      = df_h4a,
  contrasts = list(
    public_private = "contr.sum", 
    partner_choice = "contr.sum"))

# -------------- #
# TYPE III ANOVA #
# -------------- #
anova_h4X <- car::Anova(lm_h4X, type = 3)
parameters::model_parameters(anova_h4X)
effectsize::effectsize(anova_h4X) |> as.data.frame()
```

## 3 Model Comparison Statistics

```{r main-text-model-comparison-statistics, message=F, warning=F}
#| lst-label: model-comparison
#| lst-cap: Model Comparison Statistics
# ---------------- #
# MODEL COMPARISON #
# ---------------- #
dplyr::bind_rows(
  performance::compare_performance(lm_h2,  qm_h2),
  performance::compare_performance(lm_h3a, qm_h3a),
  performance::compare_performance(lm_h3b, qm_h3b),
  performance::compare_performance(lm_h4a, qm_h4a),
  performance::compare_performance(lm_h4b, qm_h4b),
  performance::compare_performance(lm_x5,  qm_x5)) |> 
  dplyr::mutate(
    Model = dplyr::if_else(
      stringr::str_starts(Name, 'lm'), 'Linear', 'Quadratic')) 

# ---------------------- # 
# LIKELIHOOD RATIO TESTS #
# ---------------------- # 
lmtest::lrtest(lm_h2,  qm_h2)
lmtest::lrtest(lm_h3a, qm_h3a)
lmtest::lrtest(lm_h3b, qm_h3b)
lmtest::lrtest(lm_h4a, qm_h4a)
lmtest::lrtest(lm_h4b, qm_h4b)
lmtest::lrtest(lm_x5,  qm_x5)
```

## 4 Correlations Between and Among Game Behavior and Morality Ratings

### Functions to Run Exploratory Correlations

```{r morality-transfer-correlations, message=F, warning=F}
# --------- # 
# PREP DATA #
# --------- #
df_x <- df_complete |> 
  ## Select relevant columns
  dplyr::select(
    participant_id, unique_group_id, participant_role, 
    public_private, partner_choice,
    
    ### DG A/A1/A2 transfers and morality ratings
    dg_a_transfer_ratio, dg_a1_transfer_ratio, dg_a2_transfer_ratio, 
    dg_a_moral, dg_a1_moral, dg_a2_moral,
    
    ### TG C, A transfers and morality ratings
    tg_c_transfer_ratio, tg_a_return_ratio, 
    tg_c_moral, tg_a_moral) |>
  
  ## Pivot morality ratings 
  ### dg_a_moral | dg_a1_moral | ... | swing into one column
  tidyr::pivot_longer(
    !c(participant_id, unique_group_id, participant_role, 
       public_private, partner_choice,
       dg_a_transfer_ratio, dg_a1_transfer_ratio, dg_a2_transfer_ratio, 
       tg_c_transfer_ratio, tg_a_return_ratio), 
    names_to = "morality_target", values_to = "morality_rating") |> 
  tidyr::drop_na(morality_rating) |> 
  
  ## Pivot transfer allocation ratios
  ### dg_a_transfer_ratio | dg_a1_transfer_ratio | ... | swing into one column
  tidyr::pivot_longer(
    !c(participant_id, unique_group_id, participant_role, 
       public_private, partner_choice, morality_target, morality_rating), 
    names_to = "transfer_allocator", values_to = "transfer") |> 
  tidyr::drop_na(transfer) |>
  
  ## Only keep morality ratings / transfers corresponding to same target / game stage
  dplyr::filter(
    (stringr::str_starts(morality_target, "dg_a_") & 
       stringr::str_starts(transfer_allocator, "dg_a_")) |
      (stringr::str_starts(morality_target, "dg_a1_") & 
         stringr::str_starts(transfer_allocator, "dg_a1_")) |
      (stringr::str_starts(morality_target, "dg_a2_") & 
         stringr::str_starts(transfer_allocator, "dg_a2_")) |
      (stringr::str_starts(morality_target, "tg_c_") & 
         stringr::str_starts(transfer_allocator, "tg_c_")) |    
      (stringr::str_starts(morality_target, "tg_a_") & 
         stringr::str_starts(transfer_allocator, "tg_a_"))) |>
  
  ## Remove "_moral" suffix from each morality rating target, make rest uppercase
  dplyr::mutate(
    morality_target = stringr::str_sub(stringr::str_to_upper(
      stringr::str_remove(morality_target, "moral")), end = -2)) |> 
  
  ## Distinguish game (DG vs. TG)
  tidyr::separate_wider_delim(
    morality_target, delim = "_", 
    names = c("morality_target_game", "morality_target")) |> 
  dplyr::mutate(
    transfer_allocator = stringr::str_remove(transfer_allocator, "_ratio")) |> 
  
  ## Distinguish stage (DG send vs. TG send vs. TG return)
  tidyr::separate_wider_delim(
    transfer_allocator, delim = "_", names = c(
      "transfer_allocator_game", "transfer_allocator", "allocation_stage")) |> 
  dplyr::select(-c(transfer_allocator_game, transfer_allocator)) |>
  
  ## Code self-other
  dplyr::mutate(
    self_other = dplyr::case_when(
      morality_target_game == "DG" & 
        participant_role == morality_target ~ "self",
      morality_target_game == "TG" &  # here we have to compare A/A1/A2 ?= A
        stringr::str_sub(participant_role, 1, 1) == morality_target ~ "self",
      .default = "other"),
    .before = public_private) |> 
  dplyr::mutate(
    morality_target_game = forcats::fct_relevel(morality_target_game, "DG", "TG"),
    allocation_stage     = forcats::fct_relevel(allocation_stage, "transfer", "return"),
    self_other           = forcats::fct_relevel(self_other, "self", "other"),
    public_private       = forcats::fct_relevel(public_private, "public", "private"),
    partner_choice       = forcats::fct_relevel(partner_choice, "yes", "no"))

# ---------------- #
# CUSTOM FUNCTIONS #
# ---------------- #
#' Generate tables for correlations between transfer amounts 
#' and morality ratings
#' 
#' @description
#' `MTCorrTab` generates printed tables of correlations with relevant 
#'   inferential statistics between transfer amounts and corresponding morality 
#'   ratings alongside Fisher's z-tests for differences between correlations 
#'   where possible.
#' 
#' @param game Trust Game or Dictator Game
#' @param stage Stage of the Trust Game, NULL for Dictator Game
#' @param grouping_vars Columns on which to subset the data for correlations.
#' @param table_caption `knitr::kable` table caption.
#' @param col_names `knitr::kable` column headings for `var1` and `var2`.
#'
#' @return A list containing a `knitr::kable` table of correlation results and a
#'   corresponding tibble of Fisher's z-test statistics testing all pairwise 
#'   comparisons of correlations if `grouping_vars` is not `NULL`.
#' @export
MTCorrTab <- function(game = NULL, stage = NULL,
                      grouping_vars = NULL, 
                      table_caption, col_names) {
  
  if (!is.null(game) & !is.null(stage)) {
    corr_df <- df_x |> 
      dplyr::filter(morality_target_game == game & allocation_stage == stage)
  } else {
    corr_df <- df_x
  }
  
  corr_df <- corr_df |> 
    dplyr::group_by(!!!rlang::syms(grouping_vars)) |> 
    tidyr::nest() |> 
    dplyr::ungroup() |> 
    dplyr::mutate(
      cor_results = purrr::map(data, 
                               ~ cor.test(~ morality_rating + transfer, .x)),
      df          = purrr::map_dbl(cor_results, ~ .$parameter),
      n           = df + 2,
      r           = purrr::map_dbl(cor_results, ~ .$estimate),
      lower_ci    = purrr::map_dbl(cor_results, ~ .$conf.int[1]),
      upper_ci    = purrr::map_dbl(cor_results, ~ .$conf.int[2]),
      ci          = paste0("[", sprintf(lower_ci, fmt = "%#.2f"), ", ", 
                           sprintf(upper_ci, fmt = "%#.2f"), "]"),
      p           = purrr::map_dbl(cor_results, ~ .$p.value)) |>
    dplyr::mutate(p = papaja::printp(p)) |> 
    dplyr::select(c(!!!rlang::syms(grouping_vars), df, n, r, ci, p)) |> 
    dplyr::arrange(!!!rlang::syms(grouping_vars))
  
  # Generate a table of results
  corr_table <- corr_df |> 
    knitr::kable(
      caption   = table_caption,
      col.names = c(col_names, "DF", "n", "r", "95% CI", "p"),
      digits    = c(rep(1, length(col_names)), 1, 1, 2, 1, 3))
  corr_all <- list(correlation = corr_table)
  
  # Generate test statistics for Fisher's Z
  if (!is.null(grouping_vars)) {
    corr_test <- corr_df |>
      dplyr::mutate(
        condition = stringr::str_c(!!!rlang::syms(grouping_vars), sep = " "),
        z_score   = psych::fisherz(r),
        n         = df + 2)
    
    row_combos <- combn(nrow(corr_test), 2, simplify = F)
    
    # Define a helper function to calculate the differences for a pair of rows
    .CalcDiff <- function(pair) {
      idx1 <- pair[1]
      idx2 <- pair[2]    
      contrast_df <- dplyr::tibble(
        contrast = paste(corr_test$condition[idx1], 
                         "-", 
                         corr_test$condition[idx2]),
        z_diff   = corr_test$z_score[idx1] - corr_test$z_score[idx2],
        se       = sqrt(
          1 / (corr_test$n[idx1] - 3) + 1 / (corr_test$n[idx2] - 3))) |> 
        dplyr::mutate(
          z = z_diff / se,
          p = 2 * pnorm(-abs(z)))
      
      return(contrast_df)
    }
    
    # Apply the function to each pair and combine the results into a single tibble
    results <- purrr::map(row_combos, .CalcDiff) |> 
      purrr::list_rbind() |> 
      dplyr::mutate(
        # z_diff = papaja::printnum(z_diff),
        se     = papaja::printnum(se),
        z      = papaja::printnum(z),
        p      = papaja::printp(p)) |>
      knitr::kable(
        col.names = c("Contrast", "z-difference", "SE", "z", "p"),
        digits    = c(1, 20, 2, 2, 3))
    
    corr_all <- list(
      correlation = corr_table, 
      fishers_z   = results)
  }
  
  # Return table and test statistics as two values in a list
  return(corr_all)
}


#' Generate tables for correlations between transfer amounts 
#' and between morality ratings
#'
#' @description
#' `MMTTCorrTab` generates printed tables of correlations with relevant 
#'   inferential statistics between transfer amounts and, separately, between 
#'   morality ratings alongside Fisher's z-tests for differences between 
#'   correlations where possible.
#'
#' @param grouping_vars Columns on which to subset the data for correlations.
#' @param x,y  Numeric vectors of data values. x and y must have the same 
#'   length.
#' @param mmtt Character string indicating whether the correlation is between
#'   transfer amounts or between morality ratings.
#' @param table_caption `knitr::kable` table caption.
#' @param col_names `knitr::kable` column headings for `var1` and `var2`.
#'
#' @return A list containing a `knitr::kable` table of correlation results and a
#'   corresponding tibble of Fisher's z-test statistics testing all pairwise 
#'   comparisons of correlations if `grouping_vars` is not `NULL`.
#' @export

MMTTCorrTab <- function(grouping_vars = NULL, x, y, mmtt = "transfer",
                        table_caption, col_names) {
  
  corr_df <- df_complete
  if (mmtt == "transfer") {
    corr_df <- corr_df |> 
      dplyr::group_by(unique_group_id) |> 
      dplyr::mutate(
        x = dplyr::if_else(is.na(x), dplyr::first(na.omit(x)), x),
        y = dplyr::if_else(is.na(y), dplyr::first(na.omit(y)), y)) |>
      dplyr::ungroup() |> 
      dplyr::distinct(unique_group_id, .keep_all = T) |> 
      dplyr::select(unique_group_id, 
                    public_private, partner_choice, 
                    !!sym(x), !!sym(y)) |> 
      tidyr::drop_na()
  }
  
  corr_df <- corr_df |>
    dplyr::group_by(unique_group_id) |>
    dplyr::mutate(
      public_private = forcats::fct_relevel(public_private, "public", "private"),
      partner_choice = forcats::fct_relevel(partner_choice, "yes", "no")) |> 
    dplyr::group_by(!!!rlang::syms(grouping_vars)) |> 
    tidyr::nest() |> 
    dplyr::ungroup() |>
    dplyr::mutate(
      cor_results = purrr::map(data, ~ cor.test(
        as.formula(paste("~", x, "+", y)), .x)),
      df          = purrr::map_dbl(cor_results, ~ .$parameter),
      r           = purrr::map_dbl(cor_results, ~ .$estimate),
      lower_ci    = purrr::map_dbl(cor_results, ~ .$conf.int[1]),
      upper_ci    = purrr::map_dbl(cor_results, ~ .$conf.int[2]),
      p_value     = papaja::printp(purrr::map_dbl(cor_results, ~ .$p.value)),
      ci          = paste0("[", sprintf(lower_ci, fmt = "%#.2f"), ", ", 
                           sprintf(upper_ci, fmt = "%#.2f"), "]")) |> 
    dplyr::select(c(!!!rlang::syms(grouping_vars), df, r, ci, p_value)) |> 
    dplyr::arrange(!!!rlang::syms(grouping_vars))
  
  # Generate a table of results
  corr_table <- corr_df |> 
    knitr::kable(
      caption   = table_caption,
      col.names = c(col_names, "DF", "r", "95% CI", "p"),
      digits    = c(rep(1, length(col_names)), 1, 2, 1, 3))
  
  corr_all <- list(correlation = corr_table)
  
  # Generate test statistics for Fisher's Z
  if (!is.null(grouping_vars)) {
    corr_test <- corr_df |>
      dplyr::mutate(
        condition = stringr::str_c(!!!rlang::syms(grouping_vars), sep = " "),
        z_score   = psych::fisherz(r),
        n         = df + 2)
    row_combos <- combn(nrow(corr_test), 2, simplify = F)
    
    # Define a helper function to calculate the differences for a pair of rows
    .CalcDiff <- function(pair) {
      idx1 <- pair[1]
      idx2 <- pair[2]    
      contrast_df <- dplyr::tibble(
        contrast = paste(corr_test$condition[idx1], 
                         "-", 
                         corr_test$condition[idx2]),
        z_diff   = corr_test$z_score[idx1] - corr_test$z_score[idx2],
        se       = sqrt(
          1 / (corr_test$n[idx1] - 3) + 1 / (corr_test$n[idx2] - 3))) |> 
        dplyr::mutate(
          z = z_diff / se,
          p = 2 * pnorm(-abs(z)))
      
      return(contrast_df)
    }
    
    # Apply the function to each pair and combine the results into a single tibble
    results <- purrr::map(row_combos, .CalcDiff) |> 
      purrr::list_rbind() |> 
      dplyr::mutate(
        z_diff = papaja::printnum(z_diff),
        se     = papaja::printnum(se),
        z      = papaja::printnum(z),
        p      = papaja::printp(p)) |>
      knitr::kable(
        col.names = c("Contrast", "z-difference", "SE", "z", "p"),
        digits    = c(1, 2, 2, 2, 3))
    
    corr_all <- list(
      correlation = corr_table,
      fishers_z   = results)
  }
  
  # Return table and test statistics as two values in a list
  return(corr_all)
}
```

### Table S3: Correlations Between Transfer Amounts and Morality Ratings Across Game Interactions

#### Collapsed Across Conditions

```{r collapsed-morality-x-transfer-ratio, message=F, warning=F}
# --------- # 
# COLLAPSED #
# --------- #
moral_x_transfer_list <- MTCorrTab(
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = NULL)
moral_x_transfer_list$correlation
rm(moral_x_transfer_list)

# ------------- # 
# OBSERVABILITY #
# ------------- #
obs_moral_x_transfer_list <- MTCorrTab(
  grouping_vars = c("public_private"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability"))
obs_moral_x_transfer_list$correlation
obs_moral_x_transfer_list$fishers_z
rm(obs_moral_x_transfer_list)

# -------------- # 
# PARTNER CHOICE #
# -------------- #
pc_moral_x_transfer_list <- MTCorrTab(
  grouping_vars = c("partner_choice"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Partner Choice"))
pc_moral_x_transfer_list$correlation
pc_moral_x_transfer_list$fishers_z
rm(pc_moral_x_transfer_list)

# ----------- # 
# PERSPECTIVE #
# ----------- #
p_moral_x_transfer_list <- MTCorrTab(
  grouping_vars = c("self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Self/Other"))
p_moral_x_transfer_list$correlation
p_moral_x_transfer_list$fishers_z
rm(p_moral_x_transfer_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
obs_pc_moral_x_transfer_list <- MTCorrTab(
  grouping_vars = c("public_private", "partner_choice"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability", "Partner Choice"))
obs_pc_moral_x_transfer_list$correlation
obs_pc_moral_x_transfer_list$fishers_z
rm(obs_pc_moral_x_transfer_list)

# --------------------------- #
# OBSERVABILITY x PERSPECTIVE #
# --------------------------- #
obs_p_moral_x_transfer_list <- MTCorrTab(
  grouping_vars = c("public_private", "self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability", "Self/Other"))
obs_p_moral_x_transfer_list$correlation
obs_p_moral_x_transfer_list$fishers_z
rm(obs_p_moral_x_transfer_list)

# ---------------------------- #
# PARTNER CHOICE x PERSPECTIVE #
# ---------------------------- #
pc_p_moral_x_transfer_list <- MTCorrTab(
  grouping_vars = c("partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Partner Choice", "Self/Other"))
pc_p_moral_x_transfer_list$correlation
pc_p_moral_x_transfer_list$fishers_z
rm(pc_p_moral_x_transfer_list)

# -------------------------------------------- #
# OBSERVABILITY x PARTNER CHOICE x PERSPECTIVE #
# -------------------------------------------- #
obs_pc_p_moral_x_transfer_list <- MTCorrTab(
  grouping_vars = c("public_private", "partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability", "Partner Choice", "Self/Other"))
obs_pc_p_moral_x_transfer_list$correlation
obs_pc_p_moral_x_transfer_list$fishers_z
rm(obs_pc_p_moral_x_transfer_list)
```

#### DG Morality x Generosity

```{r dg-send-morality-x-dg-send-transfer-ratio, message=F, warning=F}
# --------- # 
# COLLAPSED #
# --------- #
dg_moral_x_transfer_list <- MTCorrTab(
  game          = "DG", 
  stage         = "transfer",
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = NULL)
dg_moral_x_transfer_list$correlation
rm(dg_moral_x_transfer_list)

# ------------- # 
# OBSERVABILITY #
# ------------- #
dg_obs_moral_x_transfer_list <- MTCorrTab(
  game          = "DG", 
  stage         = "transfer",
  grouping_vars = c("public_private"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability"))
dg_obs_moral_x_transfer_list$correlation
dg_obs_moral_x_transfer_list$fishers_z
rm(dg_obs_moral_x_transfer_list)

# -------------- # 
# PARTNER CHOICE #
# -------------- #
dg_pc_moral_x_transfer_list <- MTCorrTab(
  game          = "DG", 
  stage         = "transfer",
  grouping_vars = c("partner_choice"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Partner Choice"))
dg_pc_moral_x_transfer_list$correlation
dg_pc_moral_x_transfer_list$fishers_z
rm(dg_pc_moral_x_transfer_list)

# ----------- # 
# PERSPECTIVE #
# ----------- #
dg_p_moral_x_transfer_list <- MTCorrTab(
  game          = "DG", 
  stage         = "transfer",
  grouping_vars = c("self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Self/Other"))
dg_p_moral_x_transfer_list$correlation
dg_p_moral_x_transfer_list$fishers_z
rm(dg_p_moral_x_transfer_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
dg_obs_pc_moral_x_transfer_list <- MTCorrTab(
  game          = "DG", 
  stage         = "transfer",
  grouping_vars = c("public_private", "partner_choice"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability", "Partner Choice"))
dg_obs_pc_moral_x_transfer_list$correlation
dg_obs_pc_moral_x_transfer_list$fishers_z
rm(dg_obs_pc_moral_x_transfer_list)

# --------------------------- #
# OBSERVABILITY x PERSPECTIVE #
# --------------------------- #
dg_obs_p_moral_x_transfer_list <- MTCorrTab(
  game          = "DG", 
  stage         = "transfer",
  grouping_vars = c("public_private", "self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability", "Self/Other"))
dg_obs_p_moral_x_transfer_list$correlation
dg_obs_p_moral_x_transfer_list$fishers_z
rm(dg_obs_p_moral_x_transfer_list)

# ---------------------------- #
# PARTNER CHOICE x PERSPECTIVE #
# ---------------------------- #
dg_pc_p_moral_x_transfer_list <- MTCorrTab(
  game          = "DG",
  stage         = "transfer",
  grouping_vars = c("partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Partner Choice", "Self/Other"))
dg_pc_p_moral_x_transfer_list$correlation
dg_pc_p_moral_x_transfer_list$fishers_z
rm(dg_pc_p_moral_x_transfer_list)

# -------------------------------------------- #
# OBSERVABILITY x PARTNER CHOICE x PERSPECTIVE #
# -------------------------------------------- #
dg_obs_pc_p_moral_x_transfer_list <- MTCorrTab(
  game          = "DG", 
  stage         = "transfer",
  grouping_vars = c("public_private", "partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings DG allocations",
  col_names     = c("Observability", "Partner Choice", "Self/Other"))
dg_obs_pc_p_moral_x_transfer_list$correlation
dg_obs_pc_p_moral_x_transfer_list$fishers_z
rm(dg_obs_pc_p_moral_x_transfer_list)
```

#### TG Morality x Send Generosity

```{r tg-send-morality-x-tg-send-transfer-ratio, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- #
tg1_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "transfer",
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = NULL)
tg1_moral_x_transfer_list$correlation
rm(tg1_moral_x_transfer_list)

# ------------- #
# OBSERVABILITY #
# ------------- #
tg1_obs_moral_x_transfer_list <- MTCorrTab(
  game          = "TG",
  stage         = "transfer",
  grouping_vars = c("public_private"),
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = c("Observability"))
tg1_obs_moral_x_transfer_list$correlation
tg1_obs_moral_x_transfer_list$fishers_z
rm(tg1_obs_moral_x_transfer_list)

# -------------- #
# PARTNER CHOICE #
# -------------- #
tg1_pc_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "transfer",
  grouping_vars = c("partner_choice"),
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = c("Partner Choice"))
tg1_pc_moral_x_transfer_list$correlation
tg1_pc_moral_x_transfer_list$fishers_z
rm(tg1_pc_moral_x_transfer_list)

# ----------- #
# PERSPECTIVE #
# ----------- #
tg1_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "transfer",
  grouping_vars = c("self_other"),
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = c("Self/Other"))
tg1_p_moral_x_transfer_list$correlation
tg1_p_moral_x_transfer_list$fishers_z
rm(tg1_p_moral_x_transfer_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
tg1_obs_pc_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "transfer",
  grouping_vars = c("public_private", "partner_choice"),
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = c("Observability", "Partner Choice"))
tg1_obs_pc_moral_x_transfer_list$correlation
tg1_obs_pc_moral_x_transfer_list$fishers_z
rm(tg1_obs_pc_moral_x_transfer_list)

# --------------------------- #
# OBSERVABILITY x PERSPECTIVE #
# --------------------------- #
tg1_obs_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "transfer",
  grouping_vars = c("public_private", "self_other"),
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = c("Observability", "Self/Other"))
tg1_obs_p_moral_x_transfer_list$correlation
tg1_obs_p_moral_x_transfer_list$fishers_z
rm(tg1_obs_p_moral_x_transfer_list)

# ---------------------------- #
# PARTNER CHOICE x PERSPECTIVE #
# ---------------------------- #
tg1_pc_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "transfer",
  grouping_vars = c("partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = c("Partner Choice", "Self/Other"))
tg1_pc_p_moral_x_transfer_list$correlation
tg1_pc_p_moral_x_transfer_list$fishers_z
rm(tg1_pc_p_moral_x_transfer_list)

# -------------------------------------------- #
# OBSERVABILITY x PARTNER CHOICE x PERSPECTIVE #
# -------------------------------------------- #
tg1_obs_pc_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "transfer",
  grouping_vars = c("public_private", "partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings TG allocations",
  col_names     = c("Observability", "Partner Choice", "Self/Other"))
tg1_obs_pc_p_moral_x_transfer_list$correlation
tg1_obs_pc_p_moral_x_transfer_list$fishers_z
rm(tg1_obs_pc_p_moral_x_transfer_list)
```

#### TG Morality x Return Generosity

```{r tg-return-morality-x-tg-return-transfer-ratio, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- #
tg2_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = NULL)
tg2_moral_x_transfer_list$correlation
rm(tg2_moral_x_transfer_list)

# ------------- # 
# OBSERVABILITY #
# ------------- #
tg2_obs_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  grouping_vars = c("public_private"),
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = c("Observability"))
tg2_obs_moral_x_transfer_list$correlation
tg2_obs_moral_x_transfer_list$fishers_z
rm(tg2_obs_moral_x_transfer_list)

# -------------- # 
# PARTNER CHOICE #
# -------------- #
tg2_pc_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  grouping_vars = c("partner_choice"),
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = c("Partner Choice"))
tg2_pc_moral_x_transfer_list$correlation
tg2_pc_moral_x_transfer_list$fishers_z
rm(tg2_pc_moral_x_transfer_list)

# ----------- #
# PERSPECTIVE #
# ----------- #
tg2_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  grouping_vars = c("self_other"),
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = c("Self/Other"))
tg2_p_moral_x_transfer_list$correlation
tg2_p_moral_x_transfer_list$fishers_z
rm(tg2_p_moral_x_transfer_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
tg2_obs_pc_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  grouping_vars = c("public_private", "partner_choice"),
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = c("Observability", "Partner Choice"))
tg2_obs_pc_moral_x_transfer_list$correlation
tg2_obs_pc_moral_x_transfer_list$fishers_z
rm(tg2_obs_pc_moral_x_transfer_list)

# --------------------------- #
# OBSERVABILITY x PERSPECTIVE #
# --------------------------- #
tg2_obs_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  grouping_vars = c("public_private", "self_other"),
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = c("Observability", "Self/Other"))
tg2_obs_p_moral_x_transfer_list$correlation
tg2_obs_p_moral_x_transfer_list$fishers_z
rm(tg2_obs_p_moral_x_transfer_list)

# ---------------------------- #
# PARTNER CHOICE x PERSPECTIVE #
# ---------------------------- #
tg2_pc_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  grouping_vars = c("partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = c("Partner Choice", "Self/Other"))
tg2_pc_p_moral_x_transfer_list$correlation
tg2_pc_p_moral_x_transfer_list$fishers_z
rm(tg2_pc_p_moral_x_transfer_list)

# -------------------------------------------- #
# OBSERVABILITY x PARTNER CHOICE x PERSPECTIVE #
# -------------------------------------------- #
tg2_obs_pc_p_moral_x_transfer_list <- MTCorrTab(
  game          = "TG", 
  stage         = "return",
  grouping_vars = c("public_private", "partner_choice", "self_other"),
  table_caption = "Correlation between morality ratings TG returns",
  col_names     = c("Observability", "Partner Choice", "Self/Other"))
tg2_obs_pc_p_moral_x_transfer_list$correlation
tg2_obs_pc_p_moral_x_transfer_list$fishers_z
rm(tg2_obs_pc_p_moral_x_transfer_list)
```

### Table S4: Correlations Between Transfer Amounts Across Game Interactions

#### DG x TG Send

```{r dg-send-transfer-ratio-x-tg-send-transfer-ratio, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- #
dg_x_tg1_transfer_list <- MMTTCorrTab(
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_c_transfer_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG and TG transfers",
  col_names     = NULL)
dg_x_tg1_transfer_list$correlation
rm(dg_x_tg1_transfer_list)

# ------------- # 
# OBSERVABILITY #
# ------------- #
dg_x_tg1_obs_transfer_list <- MMTTCorrTab(
  grouping_vars = c("public_private"),
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_c_transfer_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG and TG transfers",
  col_names     = c("Observability"))
dg_x_tg1_obs_transfer_list$correlation
dg_x_tg1_obs_transfer_list$fishers_z
rm(dg_x_tg1_obs_transfer_list)

# -------------- #
# PARTNER CHOICE #
# -------------- #
dg_x_tg1_pc_transfer_list <- MMTTCorrTab(
  grouping_vars = c("partner_choice"),
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_c_transfer_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG and TG transfers",
  col_names     = c("Partner Choice"))
dg_x_tg1_pc_transfer_list$correlation
dg_x_tg1_pc_transfer_list$fishers_z
rm(dg_x_tg1_pc_transfer_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
dg_x_tg1_obs_pc_transfer_list <- MMTTCorrTab(
  grouping_vars = c("public_private", "partner_choice"),
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_c_transfer_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG and TG transfers",
  col_names     = c("Observability", "Partner Choice"))
dg_x_tg1_obs_pc_transfer_list$correlation
dg_x_tg1_obs_pc_transfer_list$fishers_z
rm(dg_x_tg1_obs_pc_transfer_list)
```

#### TG Send x TG Return

```{r tg-send-transfer-ratio-x-tg-return-transfer-ratio, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- #
tg1_x_tg2_transfer_list <- MMTTCorrTab(
  x             = "tg_c_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between TG allocations and TG return",
  col_names     = NULL)
tg1_x_tg2_transfer_list$correlation
rm(tg1_x_tg2_transfer_list)

# ------------- # 
# OBSERVABILITY #
# ------------- #
tg1_x_tg2_obs_transfer_list <- MMTTCorrTab(
  grouping_vars = c("public_private"),
  x             = "tg_c_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between TG allocations and TG return",
  col_names     = c("Observability"))
tg1_x_tg2_obs_transfer_list$correlation
tg1_x_tg2_obs_transfer_list$fishers_z
rm(tg1_x_tg2_obs_transfer_list)

# -------------- #
# PARTNER CHOICE #
# -------------- #
tg1_x_tg2_pc_transfer_list <- MMTTCorrTab(
  grouping_vars = c("partner_choice"),
  x             = "tg_c_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between TG allocations and TG return",
  col_names     = c("Partner Choice"))
tg1_x_tg2_pc_transfer_list$correlation
tg1_x_tg2_pc_transfer_list$fishers_z
rm(tg1_x_tg2_pc_transfer_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
tg1_x_tg2_obs_pc_transfer_list <- MMTTCorrTab(
  grouping_vars = c("public_private", "partner_choice"),
  x             = "tg_c_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between TG allocations and TG return",
  col_names     = c("Observability", "Partner Choice"))
tg1_x_tg2_obs_pc_transfer_list$correlation
tg1_x_tg2_obs_pc_transfer_list$fishers_z
rm(tg1_x_tg2_obs_pc_transfer_list)
```

#### DG Send x TG Return

```{r dg-send-transfer-ratio-x-tg-return-transfer-ratio, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- # 
dg_x_tg2_transfer_list <- MMTTCorrTab(
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG allocations and TG returns",
  col_names     = NULL)
dg_x_tg2_transfer_list$correlation
rm(dg_x_tg2_transfer_list)

# ------------- # 
# OBSERVABILITY #
# ------------- #
dg_x_tg2_obs_transfer_list <- MMTTCorrTab(
  grouping_vars = c("public_private"),
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG allocations and TG returns",
  col_names     = c("Observability"))
dg_x_tg2_obs_transfer_list$correlation
dg_x_tg2_obs_transfer_list$fishers_z
rm(dg_x_tg2_obs_transfer_list)

# -------------- #
# PARTNER CHOICE #
# -------------- #
dg_x_tg2_pc_transfer_list <- MMTTCorrTab(
  grouping_vars = c("partner_choice"),
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG allocations and TG returns",
  col_names     = c("Partner Choice"))
dg_x_tg2_pc_transfer_list$correlation
dg_x_tg2_pc_transfer_list$fishers_z
rm(dg_x_tg2_pc_transfer_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
dg_x_tg2_obs_pc_transfer_list <- MMTTCorrTab(
  grouping_vars = c("public_private", "partner_choice"),
  x             = "dg_a_chosen_transfer_ratio",
  y             = "tg_a_return_ratio",
  mmtt          = "transfer",
  table_caption = "Correlation between DG allocations and TG returns",
  col_names     = c("Observability", "Partner Choice"))
dg_x_tg2_obs_pc_transfer_list$correlation
dg_x_tg2_obs_pc_transfer_list$fishers_z
rm(dg_x_tg2_obs_pc_transfer_list)
```

### Table S5: Correlations Between Morality Ratings Across Game Interactions

#### DG Morality x TG Send Morality

```{r dg-send-morality-x-tg-send-morality, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- #
dg_x_tg1_moral_list <- MMTTCorrTab(
  x             = "dg_a_chosen_moral",
  y             = "tg_c_moral",
  mmtt          = "morality",
  table_caption = "Correlation between DG and TG send morality ratings",
  col_names     = NULL)
dg_x_tg1_moral_list$correlation
rm(dg_x_tg1_moral_list)

# ------------- #
# OBSERVABILITY #
# ------------- #
dg_x_tg1_obs_moral_list <- MMTTCorrTab(
  grouping_vars = c("public_private"),
  x             = "dg_a_chosen_moral",
  y             = "tg_c_moral",
  mmtt          = "morality",
  table_caption = "Correlation between DG and TG send morality ratings",
  col_names     = c("Observability"))
dg_x_tg1_obs_moral_list$correlation
dg_x_tg1_obs_moral_list$fishers_z
rm(dg_x_tg1_obs_moral_list)

# -------------- #
# PARTNER CHOICE #
# -------------- #
dg_x_tg1_pc_moral_list <- MMTTCorrTab(
  grouping_vars = c("partner_choice"),
  x             = "dg_a_chosen_moral",
  y             = "tg_c_moral",
  mmtt          = "morality",
  table_caption = "Correlation between DG and TG send morality ratings",
  col_names     = c("Partner Choice"))
dg_x_tg1_pc_moral_list$correlation
dg_x_tg1_pc_moral_list$fishers_z
rm(dg_x_tg1_pc_moral_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
dg_x_tg1_obs_pc_moral_list <- MMTTCorrTab(
  grouping_vars = c("public_private", "partner_choice"),
  x             = "dg_a_chosen_moral",
  y             = "tg_c_moral",
  mmtt          = "morality",
  table_caption = "Correlation between DG and TG send morality ratings",
  col_names     = c("Observability", "Partner Choice"))
dg_x_tg1_obs_pc_moral_list$correlation
dg_x_tg1_obs_pc_moral_list$fishers_z
rm(dg_x_tg1_obs_pc_moral_list)
```

#### TG Send Morality x TG Return Morality

```{r tg-send-morality-x-tg-return-morality, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- #
tg1_x_tg2_moral_list <- MMTTCorrTab(
  x             = "tg_c_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between TG send and return morality ratings",
  col_names     = NULL)
tg1_x_tg2_moral_list$correlation
rm(tg1_x_tg2_moral_list)

# ------------- #
# OBSERVABILITY #
# ------------- #
tg1_x_tg2_obs_moral_list <- MMTTCorrTab(
  grouping_vars = c("public_private"),
  x             = "tg_c_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between TG send and return morality ratings",
  col_names     = c("Observability"))
tg1_x_tg2_obs_moral_list$correlation
tg1_x_tg2_obs_moral_list$fishers_z
rm(tg1_x_tg2_obs_moral_list)

# -------------- #
# PARTNER CHOICE # 
# -------------- #
tg1_x_tg2_pc_moral_list <- MMTTCorrTab(
  grouping_vars = c("partner_choice"),
  x             = "tg_c_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between TG send and return morality ratings",
  col_names     = c("Partner Choice"))
tg1_x_tg2_pc_moral_list$correlation
tg1_x_tg2_pc_moral_list$fishers_z
rm(tg1_x_tg2_pc_moral_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
tg1_x_tg2_obs_pc_moral_list <- MMTTCorrTab(
  grouping_vars = c("public_private", "partner_choice"),
  x             = "tg_c_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between TG send and return morality ratings",
  col_names     = c("Observability", "Partner Choice"))
tg1_x_tg2_obs_pc_moral_list$correlation
tg1_x_tg2_obs_pc_moral_list$fishers_z
rm(tg1_x_tg2_obs_pc_moral_list)
```

#### DG Morality x TG Return Morality

```{r dg-send-morality-x-tg-return-morality, message=F, warning=F}
# --------- #
# COLLAPSED #
# --------- #
dg_x_tg2_moral_list <- MMTTCorrTab(
  x             = "dg_a_chosen_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between DG and TG return morality ratings",
  col_names     = NULL)
dg_x_tg2_moral_list$correlation
rm(dg_x_tg2_moral_list)

# ------------- #
# OBSERVABILITY #
# ------------- #
dg_x_tg2_obs_moral_list <- MMTTCorrTab(
  grouping_vars = c("public_private"),
  x             = "dg_a_chosen_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between DG and TG return morality ratings",
  col_names     = c("Observability"))
dg_x_tg2_obs_moral_list$correlation
dg_x_tg2_obs_moral_list$fishers_z
rm(dg_x_tg2_obs_moral_list)

# -------------- #
# PARTNER CHOICE #
# -------------- #
dg_x_tg2_pc_moral_list <- MMTTCorrTab(
  grouping_vars = c("partner_choice"),
  x             = "dg_a_chosen_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between DG and TG return morality ratings",
  col_names     = c("Partner Choice"))
dg_x_tg2_pc_moral_list$correlation
dg_x_tg2_pc_moral_list$fishers_z
rm(dg_x_tg2_pc_moral_list)

# ------------------------------ #
# OBSERVABILITY x PARTNER CHOICE #
# ------------------------------ #
dg_x_tg2_obs_pc_moral_list <- MMTTCorrTab(
  grouping_vars = c("public_private", "partner_choice"),
  x             = "dg_a_chosen_moral",
  y             = "tg_a_moral",
  table_caption = "Correlation between DG and TG return morality ratings",
  col_names     = c("Observability", "Partner Choice"))
dg_x_tg2_obs_pc_moral_list$correlation
dg_x_tg2_obs_pc_moral_list$fishers_z
rm(dg_x_tg2_obs_pc_moral_list)
```

# Write Complete Data to File

```{r write-anonymized-data, message=F, warning=F}
df_complete |> 
  dplyr::select(-c(
    dplyr::matches("submit"), income, education, employment, political_overall, 
    political_overall_4_text, believe_real_better, 
    guess, technical, comments_qs)) |> 
  vroom::vroom_write(
    here::here("main/data/clean/main-data-clean-complete-anonymized.csv"),
    delim = ",")
```